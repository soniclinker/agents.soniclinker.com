(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7805],{7492:(e,t,s)=>{"use strict";s.d(t,{$:()=>l});var r=s(37876);s(14232);var n=s(69241),i=s(95313);let a={default:"bg-gray-500 hover:bg-gray-600 text-white",white:"bg-white hover:bg-gray-100 text-indigo-700 border border-indigo-700",primary:"bgHardBlue hover:bgHardBlue text-white",danger:"bg-red-600 hover:bg-red-700 text-white"},l=e=>{let{variant:t="default",loading:s=!1,children:l,className:o,loaderIcon:c,...d}=e;return(0,r.jsx)("button",{className:(0,n.A)(" text-xs font-semibold px-4 py-2 rounded-lg transition cursor-pointer flex items-center justify-center gap-2",a[t],o),disabled:s||d.disabled,...d,children:s?c||(0,r.jsx)(i.A,{className:"h-4 w-4 animate-spin"}):l})}},16821:(e,t,s)=>{"use strict";s.d(t,{A:()=>u});var r=s(42874),n=s(80498),i=s(3176),a=s(65259),l=s(20318);let o=()=>i.A.apiUrl+"/connect/update";class c{static getInstance(e){return(0,r._)(c,c,d)||(0,n._)(c,c,d,new c(e)),(0,r._)(c,c,d)}setOrgId(e){this.orgId=e}on(e,t){this.listener.add(t),"not_connected"===this.status&&this.connect()}off(e){this.listener.remove(e)}setupPing(){setTimeout(()=>{this.socket&&this.socket.readyState===WebSocket.OPEN&&(this.socket.send("{}"),this.setupPing())},3e4)}connect(){if("not_connected"!==this.status)return;this.changeStatus("connecting");let e=[],t=a.A.token();t&&e.push("access_token="+t),this.orgId&&e.push("org_id="+this.orgId);let s=e.length?"?"+e.join("&"):"";this.socket=new WebSocket(o()+s),this.socket.addEventListener("open",()=>{this.changeStatus("connected"),this.setupPing()}),this.socket.addEventListener("close",()=>{this.changeStatus("not_connected"),console.log("WebSocket closed")}),this.socket.addEventListener("message",e=>{try{let t=JSON.parse(e.data);this.listener.trigger(t)}catch(t){console.error("Invalid WebSocket message:",e.data)}})}send(e){this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify(e))}disconnect(){if(this.socket)try{this.socket.close()}catch(e){console.error("Error closing WebSocket:",e)}}changeStatus(e){this.status!==e&&(this.status=e)}constructor(e){this.status="not_connected",this.socket=null,this.orgId=e,this.listener=new l.A}}var d={writable:!0,value:null};let u=c},32722:(e,t,s)=>{"use strict";function r(e,t){if(e!==t)throw TypeError("Private static access of wrong provenance")}s.d(t,{_:()=>r})},35712:(e,t,s)=>{"use strict";function r(e,t){if(void 0===e)throw TypeError("attempted to "+t+" private static field before its declaration")}s.d(t,{_:()=>r})},42874:(e,t,s)=>{"use strict";s.d(t,{_:()=>i});var r=s(32722),n=s(35712);function i(e,t,s){return(0,r._)(e,t),(0,n._)(s,"get"),s.get?s.get.call(e):s.value}},69241:(e,t,s)=>{"use strict";function r(){for(var e,t,s=0,r="",n=arguments.length;s<n;s++)(e=arguments[s])&&(t=function e(t){var s,r,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t){if(Array.isArray(t)){var i=t.length;for(s=0;s<i;s++)t[s]&&(r=e(t[s]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r)}return n}(e))&&(r&&(r+=" "),r+=t);return r}s.d(t,{$:()=>r,A:()=>n});let n=r},72339:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var r=s(37876),n=s(74562),i=s(65259),a=s(43598),l=s(16821),o=s(89099),c=s(14232),d=s(75683),u=s(94344),h=s(7492);let g=()=>{let e=(0,o.useRouter)(),{id:t}=e.query,[s,g]=(0,c.useState)(!1),[f,b]=(0,c.useState)(null),[y,j]=(0,c.useState)([]),[w,v]=(0,c.useState)(!1),[k,N]=(0,c.useState)(!1),[A,S]=(0,c.useState)(!1),[_,q]=(0,c.useState)([]),[C,E]=(0,c.useState)(!1),[P,I]=(0,c.useState)({}),O=(0,c.useRef)(null),T=(0,c.useRef)(null);(0,u.A)([O,T],()=>E(!1));let W=(e,t)=>{e.target.checked?q(e=>[...e,t]):q(e=>e.filter(e=>e!==t))},L=(0,c.useCallback)(async e=>{let{loader:s}=e;0===y.length&&s&&g(!0);let{data:r,error:n}=await i.A.doGet({path:"/orgs/".concat(a.A.current().id,"/querysets/").concat(t,"/queries")});if(n){console.log(n),b("Something went wrong"),g(!1);return}if(r){if(0===r.queries.length){b("No questions found"),j([]),g(!1),v(!1);return}b(null),j(r.queries),v(!1),g(!1)}},[t,y.length]),M=(0,c.useCallback)(async()=>{let{data:e,error:s}=await i.A.doGet({path:"/orgs/".concat(a.A.current().id,"/querysets/").concat(t)});if(s){b("Something went wrong");return}e&&I(e.queryset.data.args),e&&"running"===e.queryset.task_status?v(!0):L({loader:!1})},[t,L]),R=async()=>{N(!0);let{data:s,error:r}=await i.A.doPost({path:"/orgs/".concat(a.A.current().id,"/aeoanalysis/tasks?queryset_id=").concat(t),data:{queries:_}});if(r){b(r.message),N(!1),console.log(r);return}if(s){if(!s.id){N(!1),b("Something went wrong");return}b(null),e.push("/aeo/history")}};return(0,c.useEffect)(()=>{M()},[A,M]),(0,c.useEffect)(()=>{let e=l.A.getInstance(a.A.current().id),t=e=>{"query_task_status"===e.type&&L({loader:!1})};return e.on("message",t),()=>{e.off("message",t)}},[L]),(0,r.jsxs)("div",{className:"bg-white  min-h-[calc(100vh-80px)]",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-2 lg:p-5 bg-white sticky top-0 z-20",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,r.jsx)("button",{className:"block cursor-pointer",onClick:()=>e.back(),children:(0,r.jsx)(d.eh5,{size:30})}),(0,r.jsx)("h2",{className:"text-sm lg:text-xl font-semibold text-[#1E2035] ",children:"List of questions"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[y.length>0&&(0,r.jsx)(h.$,{className:" disabled:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed hidden sm:block",variant:"primary",onClick:()=>n.A.show("Start New Run",(0,r.jsx)(x,{onConfirm:R})),disabled:w||k,children:"Run"}),y.length>0&&(0,r.jsx)(h.$,{className:"disabled:opacity-50 disabled:cursor-not-allowed hidden sm:block",variant:"danger",disabled:0===_.length||w,onClick:()=>n.A.show("Confirm Delete",(0,r.jsx)(m,{id:t,queries:_,refetchQuery:S,setSelectedQueries:q})),children:"Delete"}),(0,r.jsx)(h.$,{className:"disabled:opacity-50 disabled:cursor-not-allowed hidden sm:block",variant:"primary",disabled:w,onClick:()=>t&&n.A.show("Add Questions Manually",(0,r.jsx)(p,{id:t,refetchQuery:S,queries:y})),children:"Add Manually"})]})]}),s&&(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-gray-900"})}),!s&&!w&&f&&(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-red-500",children:f})}),w&&(0,r.jsx)("p",{className:"text-center",children:"We are generating questions for you, please wait..."}),!s&&!w&&y.length>0&&(0,r.jsxs)("div",{className:"sm:m-6 sm:mt-0 border-[0.80px] border-neutral-200 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex gap-3 sm:gap-4 md:gap-5 lg:gap-6 bg-neutral-100/60 text-gray-700 font-medium py-3 px-5 sticky top-12 lg:top-18",children:[(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("input",{type:"checkbox",onChange:()=>{y.length===_.length?q([]):q(y.map(e=>e.id))},checked:_.length===y.length,className:"w-3 h-3"})}),(0,r.jsx)("div",{className:"text-neutral-500 lg:text-xs font-semibold text-base flex-1 h-full",children:"Select Questions to run"})]}),y.map(e=>(0,r.jsxs)("div",{className:"border-t-[0.80px] border-neutral-200 flex items-center gap-30 sm:gap-4 md:gap-5 lg-gap-6 py-4 px-5 border-b border-l border-r hover:bg-gray-50",children:[(0,r.jsx)("div",{className:"text-sm lg:text-base h-full flex items-center justify-center",children:(0,r.jsx)("input",{type:"checkbox",id:e.id,name:e.id,checked:_.includes(e.id),onChange:t=>W(t,e.id),className:"w-3 h-3"})}),(0,r.jsx)("div",{className:"text-neutral-950 lg:text-xs font-normal text-sm flex-1 h-full",children:e.question})]},e.id))]})]})},p=e=>{let{id:t,refetchQuery:s,queries:l}=e,[o,d]=(0,c.useState)(!1),[u,h]=(0,c.useState)(null),[g,p]=(0,c.useState)(""),m=async e=>{if(e.preventDefault(),!g)return;d(!0),h(null);let r=Math.min(...l.map(e=>e.order));if((await i.A.doPost({path:"/orgs/".concat(a.A.current().id,"/querysets/").concat(t,"/queries"),data:{questions:g.split("\n").filter(e=>!!e.trim()).map(e=>({question:e.trim(),order:r-1}))}})).error){h("Something went wrong"),d(!1);return}d(!1),n.A.hide(),s(e=>!e)};return(0,r.jsxs)("form",{onSubmit:m,children:[(0,r.jsx)("textarea",{id:"question",name:"question",placeholder:"Type your questions here. One question per line.",value:g,onChange:e=>p(e.target.value),rows:10,className:"border border-neutral-300 text-neutral-400 font-medium bg-primary w-full rounded-lg p-3 mt-3 focus:ring-1 focus:ring-blue-400 focus:border-blue-400 outline-none transition"}),u&&(0,r.jsx)("div",{className:"flex items-center justify-end",children:(0,r.jsx)("span",{className:"text-red-500",children:u})}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,r.jsx)("button",{type:"button",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bgMediumBlue text-white rounded cursor-pointer",onClick:()=>n.A.hide(),children:"Cancel"}),(0,r.jsx)("button",{type:"submit",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bgMediumBlue text-white rounded cursor-pointer disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:o||!g,children:"Add"})]})]})},m=e=>{let{id:t,queries:s,refetchQuery:l,setSelectedQueries:o}=e,[d,u]=(0,c.useState)(!1),[h,g]=(0,c.useState)(null),p=async()=>{g(null),u(!0);let e=await i.A.doPost({path:"/orgs/".concat(a.A.current().id,"/querysets/").concat(t),data:{action:"delete_queries",queries:s}});if(e.error){g(e.error.message),u(!1);return}o([]),u(!1),n.A.hide(),l(e=>!e)};return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"flex items-center justify-start",children:(0,r.jsx)("span",{children:"Are you sure you want to delete this query?"})}),h&&(0,r.jsx)("div",{className:"flex items-center justify-end",children:(0,r.jsx)("span",{className:"text-red-500",children:h})}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,r.jsx)("button",{type:"button",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bg-gray-500 text-white rounded cursor-pointer",onClick:()=>n.A.hide(),children:"Cancel"}),(0,r.jsx)("button",{type:"button",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bg-red-600 text-white rounded cursor-pointer disabled:bg-gray-400 disabled:cursor-not-allowed",onClick:p,disabled:d,children:"Delete"})]})]})},x=e=>{let{onConfirm:t}=e;return(0,r.jsxs)("div",{className:"py-2 flex flex-col gap-4",children:[(0,r.jsx)("p",{children:"Are you sure you want to run all the questions?"}),(0,r.jsxs)("div",{className:"w-full flex justify-end px-4 gap-4",children:[(0,r.jsx)("button",{type:"button",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bg-gray-500 text-white rounded cursor-pointer",onClick:()=>n.A.hide(),children:"cancel"}),(0,r.jsx)("button",{type:"button",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bg-indigo-600 text-white rounded cursor-pointer disabled:bg-gray-400 disabled:cursor-not-allowed",onClick:()=>{t(),n.A.hide()},children:"Run"})]})]})}},80498:(e,t,s)=>{"use strict";s.d(t,{_:()=>i});var r=s(32722),n=s(35712);function i(e,t,s,i){return(0,r._)(e,t),(0,n._)(s,"set"),!function(e,t,s){if(t.set)t.set.call(e,s);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=s}}(e,s,i),i}},85505:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/aeo/manage",function(){return s(72339)}])},94344:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var r=s(14232);let n=(e,t)=>{(0,r.useEffect)(()=>{let s=s=>{!e.some(e=>e.current&&e.current.contains(s.target))&&t(s)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[e,t])}},95313:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(95551).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[5711,636,6593,8792],()=>t(85505)),_N_E=e.O()}]);