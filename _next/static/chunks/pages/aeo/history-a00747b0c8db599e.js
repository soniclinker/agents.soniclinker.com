(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8672],{6246:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(95551).A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},7492:(e,t,s)=>{"use strict";s.d(t,{$:()=>l});var r=s(37876);s(14232);var a=s(69241),n=s(95313);let i={default:"bg-gray-500 hover:bg-gray-600 text-white",white:"bg-white hover:bg-gray-100 text-indigo-700 border border-indigo-700",primary:"bgHardBlue hover:bgHardBlue text-white",danger:"bg-red-600 hover:bg-red-700 text-white"},l=e=>{let{variant:t="default",loading:s=!1,children:l,className:o,loaderIcon:c,...d}=e;return(0,r.jsx)("button",{className:(0,a.A)(" text-xs font-semibold px-4 py-2 rounded-lg transition cursor-pointer flex items-center justify-center gap-2",i[t],o),disabled:s||d.disabled,...d,children:s?c||(0,r.jsx)(n.A,{className:"h-4 w-4 animate-spin"}):l})}},14084:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var r=s(37876),a=s(14232);let n=e=>{let{children:t,headers:s,data:n,isLoading:i,rowKey:l,renderCell:o,className:c}=e,[d,u]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{i&&setTimeout(()=>{u(!0)},1500)},[i]),(0,r.jsxs)("div",{className:"bg-white overflow-auto ".concat((null==c?void 0:c.table)||""," pt-0"),children:[(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsx)("tr",{children:s.map(e=>(0,r.jsx)("th",{className:"p-2 md:p-3 lg:p-4 sticky top-0 bg-white z-10 text-start ".concat((null==c?void 0:c.header)||""),children:e.label},e.key))})}),i?(0,r.jsx)("tbody",{children:(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:s.length,className:"text-center py-12 text-gray-400",children:d&&(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-b-white border-indigo-600"})})})})}):(0,r.jsx)("tbody",{children:0===n.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:s.length,className:"text-center py-12 text-gray-400",children:"No data found."})}):n.map((e,t)=>(0,r.jsx)("tr",{className:"text-start hover:bg-gray-200 ".concat(null==c?void 0:c.body),children:s.map((s,a)=>(0,r.jsx)("td",{className:"p-2 md:p-3 lg:p-4 ".concat(null==c?void 0:c.bodyData),children:o?o(e,s,a,t):e[s.key]},s.key))},l(e,t)))})]}),n.length>0&&!i&&t]})}},16691:()=>{},28067:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(95551).A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},31984:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>j});var r=s(37876),a=s(42059),n=s(74562),i=s(7492),l=s(65259),o=s(43598),c=s(16821),d=s(89099),u=s(14232);s(16691),s(58198);var x=s(9614),h=s(6630),m=s(98188),g=s(14084),p=s(82400);let b=new Date,y=new Date(b);y.setDate(b.getDate()-7),y.setHours(0,0,0,0);let f=new Date(b);f.setHours(23,59,59,999),y.getTime(),f.getTime();let j=()=>{let e=(0,d.useRouter)(),[t,s]=(0,u.useState)([]),[x,p]=(0,u.useState)(!1),[b,y]=(0,u.useState)(!1),[f,j]=(0,u.useState)(null),[A,C]=(0,u.useState)(""),[_,S]=(0,u.useState)(!1),[P,E]=(0,u.useState)(!1),[D,q]=(0,u.useState)(!1),[z,R]=(0,u.useState)(1),[T,I]=(0,u.useState)(10),M=Math.ceil(t.length/T),G=t.slice((z-1)*T,z*T),H=async e=>{var t,s;let r="/orgs/".concat(null===(t=o.A.current())||void 0===t?void 0:t.id,"/aeoanalysis/tasks?queryset_id=").concat(e,"&limit=1");p(!0),j(null);let{data:a,error:n}=await l.A.doGet({path:r});if(n){q(!1),p(!1);return}(null==a?void 0:null===(s=a.tasks)||void 0===s?void 0:s[0])&&q(!0),p(!1)},B=async e=>{if(P)return;E(!0);let{data:t,error:s}=await l.A.doPost({path:"/orgs/".concat(o.A.current().id,"/aeoanalysis/tasks?queryset_id=").concat(e)});if(s){j("Something went wrong."),E(!1);return}return t},F=async(e,t)=>{var r,a;if(!e)return;t&&y(!0);let n="/orgs/".concat(null===(r=o.A.current())||void 0===r?void 0:r.id,"/aeoanalysis/tasks?queryset_id=").concat(e),{data:i,error:c}=await l.A.doGet({path:n});if(c){j("Failed to fetch runs"),s([]),p(!1);return}return s(i.tasks||[]),y(!1),(null===(a=i.tasks[0])||void 0===a?void 0:a.status)==="completed"&&E(!1),i.tasks.length};return(0,u.useEffect)(()=>{F(A,!1)},[_]),(0,u.useEffect)(()=>{var e;let t;p(!0);let s=c.A.getInstance(null===(e=o.A.current())||void 0===e?void 0:e.id);return(async()=>{let e=await o.A.checkAndGetAeoProject();return e||(j("Project not found"),p(!1),n.A.show("Create new project",(0,r.jsx)(h.default,{}),!1,"90%"))})().then(e=>{C(null==e?void 0:e.id),p(!1),t=t=>{"analysis_task_status"===t.type&&F(e.id,!1)},s.on("message",t)}),()=>{s.off("message",t)}},[]),(0,u.useEffect)(()=>{z>M&&R(1)},[M,z]),(0,u.useEffect)(()=>{A&&F(A,!0),A&&H(A)},[A]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.A,{children:(0,r.jsx)(i.$,{variant:"primary",className:"hover:bg-[#5a3fd6] transition-all disabled:opacity-40",disabled:P,onClick:async()=>{let{id:t}=await o.A.checkAndGetAeoProject();t&&(D?n.A.show("Start New Run",(0,r.jsx)(k,{onConfirm:async()=>{await B(t)&&S(e=>!e)}})):e.push({pathname:"/aeo/manage",query:{id:t}}))},children:D?"Re-run":"Create New Run"})}),(0,r.jsx)(g.A,{headers:[{label:(0,r.jsx)(v,{label:"SOV"}),key:"sov"},{label:(0,r.jsx)(v,{label:"Start Time"}),key:"created_at"},{label:(0,r.jsx)(v,{label:"Questions"}),key:"questions"},{label:(0,r.jsx)(v,{label:"Status"}),key:"status"},{label:"More",key:"actions"}],data:G,isLoading:x||b,rowKey:e=>e.id,renderCell:(e,t)=>{if("sov"===t.key){var s;let t=null===(s=e.data.result)||void 0===s?void 0:s.sov;return"number"==typeof t?Number.isInteger(t)?"".concat(t," %"):"".concat(t.toFixed(2)," %"):"--"}if("questions"===t.key){let t=e.data&&"object"==typeof e.data&&"result"in e.data?e.data.result:void 0;return t&&"number"==typeof t.num_questions?t.num_questions:"--"}return"status"===t.key?(0,r.jsx)(w,{status:e.status}):"created_at"===t.key?new Date(Number(e.created_at)).toLocaleString("en-GB",{weekday:"short",day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}):"actions"===t.key?(0,r.jsx)(N,{id:e.id,status:e.status,setRefetch:S}):t.key in e?e[t.key]:void 0},className:{table:"h-[calc(100vh-9.1875rem)]",header:"border-b border-neutral-200 text-neutral-500 text-xs font-medium bg-neutral-100!",body:"border-b border-neutral-200",bodyData:"text-sm"},children:(0,r.jsx)(m.A,{currentPage:z,setCurrentPage:R,totalItems:t.length,itemsPerPage:T,setItemsPerPage:I})})]})},v=e=>{let{label:t}=e;return(0,r.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)(x.H2l,{size:16,className:"text-neutral-500"})]})},w=e=>{let{status:t}=e;return(0,r.jsx)("span",{className:"px-3 py-1 rounded-full text-xs capitalize font-semibold ".concat({running:"bg-blue-100 text-blue-600",completed:"bg-green-100 text-green-600",failed:"bg-red-100 text-red-500"}[t]||""),children:t})},N=e=>{let{id:t,status:s,setRefetch:a}=e,i=(0,d.useRouter)(),l=p.A.isSuperAdmin();return(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsx)("button",{className:"text-indigo-600 hover:underline text-xs font-medium disabled:opacity-50 disabled:cursor-not-allowed disabled:text-gray-300",disabled:"completed"!==s,onClick:()=>{"running"!==s&&i.push("/aeo/history/questions?runId=".concat(t))},children:"View Questions"}),(0,r.jsx)("button",{className:"text-indigo-600 hover:underline text-xs font-medium disabled:opacity-50 disabled:cursor-not-allowed disabled:text-gray-300",disabled:"completed"!==s,onClick:()=>{"running"!==s&&i.push("/aeo/citations?runId=".concat(t))},children:"View Citations"}),l&&(0,r.jsx)("button",{className:"text-indigo-600 hover:underline text-xs font-medium disabled:opacity-50 disabled:cursor-not-allowed disabled:text-gray-300",disabled:"completed"!==s,onClick:()=>{"running"!==s&&n.A.show("Delete Confirmation",(0,r.jsx)(A,{id:t,setRefetch:a}))},children:"Delete"})]})},k=e=>{let{onConfirm:t}=e;return(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"py-2 flex flex-col gap-4",children:[(0,r.jsx)("p",{children:"Are you sure you want to rerun?"}),(0,r.jsxs)("div",{className:"w-full flex justify-end px-4 gap-4",children:[(0,r.jsx)("button",{type:"button",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bg-gray-500 text-white rounded cursor-pointer",onClick:()=>n.A.hide(),children:"cancel"}),(0,r.jsx)("button",{type:"button",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bg-indigo-600 text-white rounded cursor-pointer disabled:bg-gray-400 disabled:cursor-not-allowed",onClick:()=>{t(),n.A.hide()},children:"Re-run"})]})]})})},A=e=>{let{id:t,setRefetch:s}=e,[a,i]=(0,u.useState)(!1),[c,d]=(0,u.useState)(null),x=async()=>{d(null),i(!0);let e=await l.A.doDelete({path:"/orgs/".concat(o.A.current().id,"/aeoanalysis/tasks/").concat(t)});if(e.error){d(e.error.message),i(!1);return}i(!1),s(e=>!e),n.A.hide()};return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"flex items-center justify-start",children:(0,r.jsx)("span",{children:"Are you sure you want to delete this run?"})}),c&&(0,r.jsx)("div",{className:"flex items-center justify-end",children:(0,r.jsx)("span",{className:"text-red-500",children:c})}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,r.jsx)("button",{type:"button",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bg-gray-500 text-white rounded cursor-pointer",onClick:()=>n.A.hide(),children:"Cancel"}),(0,r.jsx)("button",{type:"button",className:"lg:px-4 lg:py-2 text-sm px-2 py-1 bg-red-600 text-white rounded cursor-pointer disabled:bg-gray-400 disabled:cursor-not-allowed",onClick:x,disabled:a,children:"Delete"})]})]})}},32722:(e,t,s)=>{"use strict";function r(e,t){if(e!==t)throw TypeError("Private static access of wrong provenance")}s.d(t,{_:()=>r})},35712:(e,t,s)=>{"use strict";function r(e,t){if(void 0===e)throw TypeError("attempted to "+t+" private static field before its declaration")}s.d(t,{_:()=>r})},36909:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/aeo/history",function(){return s(31984)}])},42059:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var r=s(37876),a=s(14232),n=s(89099),i=s(43598);let l=()=>{let e=(0,n.useRouter)(),t=e.asPath,[s,l]=(0,a.useState)("aeo"),o=t.split("/").filter(e=>!(""===e||e.startsWith("?")||e.startsWith("#"))).map(e=>"aeo"===e?s:e),c=o.map((a,n)=>{let i=n===o.length-1;return(0,r.jsxs)("div",{className:"inline",children:[(0,r.jsx)("span",{className:"text-[#737373] font-medium capitalize cursor-pointer hover:underline",onClick:()=>{if(i)return;let r=o.slice(0,n+1),a="/".concat(r.map(e=>e===s?1===r.length?"/aeo/overview":"aeo":e).join("/"));a!==t&&a!=="/".concat(o[0])&&e.push(a)},children:a.replace(/-/g," ")}),!i&&(0,r.jsx)("span",{className:"text-[#737373] font-medium",children:" > "})]},n)});return(0,a.useEffect)(()=>{(async()=>{let e=await i.A.currentAeoProject();e&&l(e.name)})()},[]),(0,r.jsx)("div",{children:c})},o=e=>{let{children:t,title:s}=e;return(0,r.jsxs)("div",{className:"w-full bg-white border-b-[1px] border-gray-200 p-4 flex justify-between items-center gap-4 flex-wrap sticky top-0 z-20",children:[s||(0,r.jsx)(l,{}),t&&(0,r.jsx)("div",{className:"flex gap-4 items-center justify-between",children:t})]})}},42874:(e,t,s)=>{"use strict";s.d(t,{_:()=>n});var r=s(32722),a=s(35712);function n(e,t,s){return(0,r._)(e,t),(0,a._)(s,"get"),s.get?s.get.call(e):s.value}},48963:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(95551).A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},58198:()=>{},69241:(e,t,s)=>{"use strict";function r(){for(var e,t,s=0,r="",a=arguments.length;s<a;s++)(e=arguments[s])&&(t=function e(t){var s,r,a="";if("string"==typeof t||"number"==typeof t)a+=t;else if("object"==typeof t){if(Array.isArray(t)){var n=t.length;for(s=0;s<n;s++)t[s]&&(r=e(t[s]))&&(a&&(a+=" "),a+=r)}else for(r in t)t[r]&&(a&&(a+=" "),a+=r)}return a}(e))&&(r&&(r+=" "),r+=t);return r}s.d(t,{$:()=>r,A:()=>a});let a=r},80498:(e,t,s)=>{"use strict";s.d(t,{_:()=>n});var r=s(32722),a=s(35712);function n(e,t,s,n){return(0,r._)(e,t),(0,a._)(s,"set"),!function(e,t,s){if(t.set)t.set.call(e,s);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=s}}(e,s,n),n}},95313:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(95551).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},98188:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var r=s(37876),a=s(14232),n=s(6246),i=s(28067),l=s(48963);let o=e=>{let{currentPage:t,setCurrentPage:s,totalItems:o,itemsPerPage:c,setItemsPerPage:d,hidePageNumbers:u=!1}=e,[x,h]=(0,a.useState)(!1),m=Math.ceil(o/c);if(o<=1)return null;let g=e=>{e>=1&&e<=m&&s(e)},p=e=>{d(e),s(1),h(!1)};return(0,r.jsxs)("div",{className:"flex items-center justify-between py-4 px-6 bg-white border-t border-gray-200",children:[(0,r.jsx)("div",{className:"flex items-center text-sm text-gray-600",children:(0,r.jsxs)("span",{children:["Page ",t," of ",m]})}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:()=>g(t-1),disabled:1===t,className:"w-8 h-8 rounded flex items-center justify-center transition-colors ".concat(1===t?"text-gray-300 cursor-not-allowed":"text-gray-600 hover:bg-gray-100 cursor-pointer"),children:(0,r.jsx)(n.A,{size:16})}),!u&&(0,r.jsx)("div",{className:"flex items-center gap-1 mx-2",children:(()=>{let e=[];if(m<=5)for(let s=1;s<=m;s++)e.push((0,r.jsx)("button",{onClick:()=>g(s),className:"w-8 h-8 rounded text-sm font-medium transition-colors cursor-pointer ".concat(t===s?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"),children:s},s));else{if(e.push((0,r.jsx)("button",{onClick:()=>g(1),className:"w-8 h-8 rounded text-sm cursor-pointer font-medium transition-colors ".concat(1===t?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"),children:"1"},1)),t<=3){for(let s=2;s<=Math.min(4,m-1);s++)e.push((0,r.jsx)("button",{onClick:()=>g(s),className:"w-8 h-8 rounded text-sm cursor-pointer font-medium transition-colors ".concat(t===s?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"),children:s},s));m>5&&e.push((0,r.jsx)("span",{className:"w-8 h-8 flex items-center justify-center text-gray-400",children:"..."},"ellipsis"))}else if(t>=m-2){m>5&&e.push((0,r.jsx)("span",{className:"w-8 h-8 flex  items-center justify-center text-gray-400",children:"..."},"ellipsis"));for(let s=Math.max(m-3,2);s<=m-1;s++)e.push((0,r.jsx)("button",{onClick:()=>g(s),className:"w-8 h-8 rounded text-sm cursor-pointer font-medium transition-colors ".concat(t===s?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"),children:s},s))}else{e.push((0,r.jsx)("span",{className:"w-8 h-8 flex items-center justify-center text-gray-400",children:"..."},"ellipsis1"));for(let s=t-1;s<=t+1;s++)e.push((0,r.jsx)("button",{onClick:()=>g(s),className:"w-8 h-8 rounded text-sm cursor-pointer font-medium transition-colors ".concat(t===s?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"),children:s},s));e.push((0,r.jsx)("span",{className:"w-8 h-8 flex items-center justify-center text-gray-400",children:"..."},"ellipsis2"))}m>1&&e.push((0,r.jsx)("button",{onClick:()=>g(m),className:"w-8 h-8 rounded text-sm font-medium transition-colors ".concat(t===m?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"),children:m},m))}return e})()}),(0,r.jsx)("button",{onClick:()=>g(t+1),disabled:t===m,className:"w-8 h-8 rounded flex items-center justify-center transition-colors ".concat(t===m?"text-gray-300 cursor-not-allowed":"text-gray-600 hover:bg-gray-100 cursor-pointer"),children:(0,r.jsx)(i.A,{size:16})})]}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-600 relative",children:[(0,r.jsxs)("span",{className:"mr-2",children:[c," per page"]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{onClick:()=>h(!x),className:"flex items-center cursor-pointer justify-center w-6 h-6 rounded hover:bg-gray-100 transition-colors",children:(0,r.jsx)(l.A,{size:16})}),x&&(0,r.jsx)("div",{className:"absolute right-0 bottom-[35px] mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-10 min-w-[120px]",children:[5,10,20,50].map(e=>(0,r.jsxs)("button",{onClick:()=>p(e),className:"w-full cursor-pointer px-3 py-2 text-left text-sm hover:bg-gray-50 transition-colors ".concat(c===e?"bg-blue-50 text-blue-600":"text-gray-700"),children:[e," per page"]},e))})]})]}),x&&(0,r.jsx)("div",{className:"fixed inset-0 z-0",onClick:()=>h(!1)})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[9034,4249,636,6593,8792],()=>t(36909)),_N_E=e.O()}]);