(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7693],{8824:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>J});var a=s(37876),n=s(14232);let l=e=>{let{header:t,subheader:s,children:n,className:l=""}=e;return(0,a.jsxs)("div",{className:"w-full bg-white rounded-lg shadow-none border-0 p-0 ".concat(l),children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-base font-semibold text-[#222] mb-1",children:t}),s&&(0,a.jsx)("div",{className:"text-xs text-gray-500 mb-2",children:s})]})}),n]})};var r=s(15451),i=s(38412),o=s(7972),d=s(7e3),c=s(71547),u=s(53970),m=s(23618),x=s(12171),h=s(37096),f=s(35324),v=s(98275),g=s(70505);let p=()=>{let e=new Date,t=new Date(e);t.setMonth(e.getMonth()-6),t.setHours(0,0,0,0);let s=new Date(e);return s.setHours(23,59,59,999),{startDate:t.getTime(),endDate:s.getTime(),key:"selection"}},y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"date_range",t=sessionStorage.getItem(e);if(!t)return null;let s=JSON.parse(t);return s.type&&"custom"!==s.type?{...w(s.type),key:"selection"}:"custom"===s.type&&s.startDate&&s.endDate?{startDate:s.startDate,endDate:s.endDate,key:"selection"}:null},j=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"date_range";if(e.startDate&&e.endDate){let s=b(e.startDate,e.endDate);if("custom"!==s)return sessionStorage.setItem(t,JSON.stringify({type:s,key:"selection"})),{...w(s),key:"selection"};{let s=new Date(e.startDate);s.setHours(0,0,0,0);let a=new Date(e.endDate);a.setHours(23,59,59,999);let n={type:"custom",startDate:s.getTime(),endDate:a.getTime(),key:"selection"};return sessionStorage.setItem(t,JSON.stringify(n)),n}}return null},b=(e,t)=>{let s=new Date;if((0,d.o)(e).getTime()===(0,d.o)(s).getTime()&&(0,c.D)(t).getTime()===(0,c.D)(s).getTime())return"today";let a=(0,u.e)(s,1);if((0,d.o)(e).getTime()===(0,d.o)(a).getTime()&&(0,c.D)(t).getTime()===(0,c.D)(a).getTime())return"yesterday";if((0,m.k)(e).getTime()===(0,m.k)(s).getTime()&&(0,c.D)(t).getTime()===(0,x.$)(s).getTime())return"this_week";let n=(0,m.k)((0,h.k)(s,1)),l=(0,x.$)((0,h.k)(s,1));if((0,d.o)(e).getTime()===(0,d.o)(n).getTime()&&(0,c.D)(t).getTime()===(0,c.D)(l).getTime())return"last_week";if((0,f.w)(e).getTime()===(0,f.w)(s).getTime()&&(0,c.D)(t).getTime()===(0,v.p)(s).getTime())return"this_month";let r=(0,f.w)((0,g.a)(s,1)),i=(0,v.p)((0,g.a)(s,1));return(0,d.o)(e).getTime()===(0,d.o)(r).getTime()&&(0,c.D)(t).getTime()===(0,c.D)(i).getTime()?"last_month":"custom"};function w(e){let t,s;let a=new Date;switch(e){case"today":(t=new Date(a)).setHours(0,0,0,0),(s=new Date(a)).setHours(23,59,59,999);break;case"last_week":(t=new Date(a)).setDate(a.getDate()-7),t.setHours(0,0,0,0),(s=new Date(a)).setHours(23,59,59,999);break;case"last_month":t=new Date(a.getFullYear(),a.getMonth()-1,1),s=new Date(a.getFullYear(),a.getMonth(),0,23,59,59,999);break;case"this_week":(t=new Date(a)).setDate(a.getDate()-a.getDay()),t.setHours(0,0,0,0),(s=new Date(a)).setHours(23,59,59,999);break;case"this_month":t=new Date(a.getFullYear(),a.getMonth(),1),(s=new Date(a)).setHours(23,59,59,999);break;case"yesterday":(t=new Date(a)).setDate(a.getDate()-1),t.setHours(0,0,0,0),(s=new Date(a)).setDate(a.getDate()-1),s.setHours(23,59,59,999);break;default:t=new Date(a),s=new Date(a)}return{startDate:t.getTime(),endDate:s.getTime()}}let D=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dd MMM, yyyy";return"".concat((0,r.GP)(e.startDate,t)," â€“ ").concat((0,r.GP)(e.endDate,t))},N=e=>{let{value:t,onChange:s,handleDateRangeSelection:l,storageKey:r="date_range",dateFormat:d="dd MMM, yyyy",minDate:c,maxDate:u=new Date}=e,m=void 0!==t&&"function"==typeof s,[x,h]=(0,n.useState)(y(r)||p()),[f,v]=(0,n.useState)(!1),g=(0,n.useRef)(null),b=m?t:x,w=m?s:h,N=(0,n.useMemo)(()=>D(b,d),[b,d]),k=(0,n.useMemo)(()=>[{...b,startDate:new Date(b.startDate),endDate:new Date(b.endDate)}],[b]);return(0,n.useEffect)(()=>{l&&l(b)},[b]),(0,n.useEffect)(()=>{if(f)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)};function e(e){g.current&&!g.current.contains(e.target)&&v(!1)}},[f]),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("div",{className:"relative",ref:g,children:[(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsxs)("button",{className:"flex items-center border border-gray-300 rounded-lg px-3 py-2 text-xs bg-white",onClick:()=>v(e=>!e),"aria-haspopup":"dialog","aria-expanded":f,"aria-label":"Select date range",type:"button",children:[(0,a.jsx)("span",{className:"mr-2",children:N}),(0,a.jsx)(o.fK4,{className:"text-base"})]})}),f&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>v(!1),style:{background:"transparent"}}),(0,a.jsx)("div",{className:"absolute right-0 z-20 bg-white shadow-lg mt-2",role:"dialog","aria-modal":"true",children:(0,a.jsx)(i.Ur,{editableDateInputs:!0,onChange:e=>{let t=j(e.selection,r);t&&w(t)},moveRangeOnFirstSelection:!1,ranges:k,direction:"horizontal",minDate:c,maxDate:u})})]})]})})};var k=s(42059),S=s(68869),_=s(49325),T=s(94499),A=s(65748),M=s(7623),E=s(19926),O=s(23518),q=s(92889),C=s(89099);let F=e=>{let{active:t,payload:s,label:n}=e,l=(0,C.useRouter)();if(t&&s&&s.length){let e=s[0].payload,t=(0,r.GP)(new Date(e.createdAt),"MMM dd, yyyy, hh:mm:ss a");return(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-3 shadow text-xs min-w-[140px]",style:{pointerEvents:"auto"},children:[(0,a.jsx)("div",{className:"mb-1 text-black font-semibold",children:t}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1 text-black font-medium",children:[(0,a.jsx)("span",{children:"SOV"}),(0,a.jsxs)("span",{className:"font-bold text-green-600",children:[e.sov.toFixed(2),"%"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1 text-black font-medium",children:[(0,a.jsx)("span",{children:"Run ID:"}),(0,a.jsx)("span",{children:e.runId})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1 text-black font-medium",children:[(0,a.jsx)("span",{children:"Questions:"}),(0,a.jsx)("span",{children:e.questions})]}),(0,a.jsx)("button",{className:"text-blue-600 underline text-xs mt-2 block",type:"button",onClick:()=>l.push("/query/run-history/questions?runId=".concat(e.runId)),children:"View Questions"})]})}return null},H=e=>{let{cx:t,cy:s}=e;return(0,a.jsx)("circle",{cx:t,cy:s,r:6,fill:"#6366f1",stroke:"#fff",strokeWidth:2})},R=e=>{let{chartData:t,selectedQuerySet:s,runs:n,dropdownOpen:l,setDropdownOpen:r,setSelectedQuerySet:i,dropdownRef:o,isFetching:d}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"w-full h-56 relative",children:0===t.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-gray-400 text-sm",children:d?"Loading...":"No data found"}):(0,a.jsx)(S.u,{width:"100%",height:"100%",children:(0,a.jsxs)(_.b,{data:[...t].reverse(),margin:{top:20,right:40,left:0,bottom:0},children:[(0,a.jsx)("defs",{children:(0,a.jsxs)("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,a.jsx)("stop",{offset:"0%",stopColor:"#6366f1",stopOpacity:.35}),(0,a.jsx)("stop",{offset:"60%",stopColor:"#6366f1",stopOpacity:.12}),(0,a.jsx)("stop",{offset:"100%",stopColor:"#6366f1",stopOpacity:0})]})}),(0,a.jsx)(T.d,{vertical:!1,strokeDasharray:"3 3",stroke:"#f3f3f3"}),(0,a.jsx)(A.W,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fontSize:12,fill:"#888"},dy:8}),(0,a.jsx)(M.h,{domain:[0,100],axisLine:!1,tickLine:!1,tick:{fontSize:12,fill:"#888"},dx:-8,ticks:[0,25,50,75,100]}),(0,a.jsx)(E.m,{content:(0,a.jsx)(F,{}),cursor:{stroke:"#6366f1",strokeWidth:1,opacity:.1}}),(0,a.jsx)(O.G,{type:"monotone",dataKey:"value",stroke:"none",fill:"url(#colorUv)"}),(0,a.jsx)(q.N,{type:"monotone",dataKey:"value",stroke:"#6366f1",strokeWidth:2.5,dot:(0,a.jsx)(H,{}),activeDot:{r:6}})]})})})})};var L=s(94344),z=s(74562),P=s(75683);let G=e=>{let{options:t,selected:s,onSelect:l,placeholder:r="Select an option",className:i="",widthClass:o="w-48"}=e,[d,c]=(0,n.useState)(!1),u=(0,n.useRef)(null);(0,L.A)([u],()=>c(!1));let m=t.find(e=>e.value===s);return(0,a.jsxs)("div",{ref:u,className:"relative ".concat(i),children:[(0,a.jsxs)("button",{type:"button",className:"flex items-center justify-between rounded-lg shadow-[0px_1px_2px_0px_rgba(0,0,0,0.05)] outline-1 outline-offset-[-1px] outline-neutral-200 bg-white px-3 py-2 hover:shadow transition-all min-w-[120px] ".concat(o),onClick:()=>c(e=>!e),children:[(0,a.jsx)("span",{className:"text-neutral-950 text-xs font-normal truncate",children:m?m.label:r}),(0,a.jsx)(P.q2p,{className:"text-black text-lg -ml-1",size:16})]}),d&&(0,a.jsxs)("div",{className:"absolute right-0 top-12 z-50 bg-white border border-gray-200 rounded shadow ".concat(o," max-h-56 overflow-y-auto"),children:[0===t.length&&(0,a.jsx)("div",{className:"px-4 py-2 text-gray-400",children:"No options"}),t.map(e=>(0,a.jsxs)("div",{className:"px-4 py-2 cursor-pointer hover:bg-gray-100 ".concat(s===e.value?"bg-gray-100 font-bold":""),onClick:()=>{l(e.value,e),c(!1)},children:[(0,a.jsx)("div",{className:"font-medium truncate",children:e.label}),e.description&&(0,a.jsx)("div",{className:"text-xs text-gray-500 truncate",children:e.description})]},e.value))]})]})};var I=s(65259),V=s(43598);s(16691),s(58198);var B=s(60542);let Q=new Date,W=new Date(Q);W.setMonth(Q.getMonth()-6),W.setHours(0,0,0,0);let K=new Date(Q);K.setHours(23,59,59,999);let U={startDate:W.getTime(),endDate:K.getTime(),key:"selection"},J=()=>{var e,t,s,r,i,o;let[d,c]=(0,n.useState)([]),[u,m]=(0,n.useState)([]),[x,h]=(0,n.useState)(!1),[f,v]=(0,n.useState)(""),[g,p]=(0,n.useState)(null),[j,b]=(0,n.useState)(null),[w,D]=(0,n.useState)(!1),[S,_]=(0,n.useState)(y()||U),[T,A]=(0,n.useState)(null),[M,E]=(0,n.useState)(!0),O=(0,n.useRef)(null);(0,L.A)([O],()=>D(!1));let q=async e=>{var t;if(!e)return;let{data:s,error:a}=await I.A.doGet({path:"/orgs/".concat(null===(t=V.A.current())||void 0===t?void 0:t.id,"/aeoanalysis/tasks?queryset_id=").concat(f)});if(a){b("Failed to fetch runs"),c([]);return}s.tasks.length>0&&p(s.tasks[0]),c(s.tasks||[])},C=async(e,t)=>{var s;if(!e||!t.startDate||!t.endDate)return;let a="/orgs/".concat(null===(s=V.A.current())||void 0===s?void 0:s.id,"/aeoanalysis/tasks?queryset_id=").concat(e);t.startDate&&t.endDate&&(a+="&start_date=".concat(t.startDate,"&end_date=").concat(t.endDate));let{data:n,error:l}=await I.A.doGet({path:a});if(l){b("Failed to fetch runs"),m([]),h(!1);return}return m(n.tasks||[]),M&&E(!1),n.tasks.length},F="My Brand";for(let s of(null==T?void 0:null===(t=T.result)||void 0===t?void 0:null===(e=t.info)||void 0===e?void 0:e.args)||[])if("brand"===s.id){F=(s.value||"").trim().split(",")[0].trim();break}let H=u.map(e=>{var t,s,a,n,l,r,i,o,d;return{date:new Date(Number(e.created_at)).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}),value:Number(null!==(i=null===(s=e.data)||void 0===s?void 0:null===(t=s.result)||void 0===t?void 0:t.sov)&&void 0!==i?i:0),runId:e.id,questions:Number(null!==(o=null===(n=e.data)||void 0===n?void 0:null===(a=n.result)||void 0===a?void 0:a.num_questions)&&void 0!==o?o:0),highlight:!1,sov:Number(null!==(d=null===(r=e.data)||void 0===r?void 0:null===(l=r.result)||void 0===l?void 0:l.sov)&&void 0!==d?d:0),createdAt:Number(e.created_at)}});(0,n.useEffect)(()=>{f&&S.startDate&&S.endDate&&C(f,S),f&&q(f)},[f,S]),(0,n.useEffect)(()=>{(async()=>{h(!0);let e=await V.A.checkAndGetAeoProject();if(!e)return b("Project not found"),h(!1),z.A.show("Create new project",(0,a.jsx)(B.default,{}),!1,"90%");v(e.id),setTimeout(()=>{C(f,S),q(f),h(!1)},0)})()},[]);let P=null==g?void 0:null===(s=g.data)||void 0===s?void 0:s.result;(0,n.useEffect)(()=>{let e=async()=>{if(!g)return;b(null);let e="/orgs/".concat(V.A.current().id,"/aeoanalysis/tasks/").concat(g.id,"?fetch_result=true"),t=await I.A.doGet({path:e});if(t.error){b("Failed to fetch analysis data"),h(!1);return}A(t.data.task)};g&&e()},[g]);let Q=[{label:"Total Questions Run",value:null!==(r=null==P?void 0:P.num_questions)&&void 0!==r?r:"-"},{label:"My SOV (Brand Mentions)",value:(null==P?void 0:P.sov)!==void 0?"".concat(Number(P.sov).toFixed(2),"%"):"-"},{label:"All Brand Mentions",value:null!==(i=null==P?void 0:P.num_brands)&&void 0!==i?i:"-"},{label:"Citations",value:null!==(o=null==P?void 0:P.num_sources)&&void 0!==o?o:"-"}],W=d.map(e=>{var t;return{label:(null===(t=e.data)||void 0===t?void 0:t.queryset_name)||"Unnamed Run",value:e.id,description:new Date(Number(e.created_at)).toLocaleString()}});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.A,{}),(0,a.jsxs)("div",{className:"px-5 md:px-5 py-5 md:py-4 bg-white fontDmSans",children:[(0,a.jsx)(l,{header:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-base font-semibold text-[#222] mb-1",children:"Visibility Score"}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mb-2",children:"Percentage of responses mentioning your Brand over the selected date range."})]}),(0,a.jsx)("div",{className:"mt-2 md:mt-0",children:(0,a.jsx)(N,{handleDateRangeSelection:e=>C(f,{...e,key:"selection"})})})]}),children:(0,a.jsx)(R,{chartData:H,selectedQuerySet:g,runs:u,dropdownOpen:w,setDropdownOpen:D,setSelectedQuerySet:p,dropdownRef:O,isFetching:M})}),d.length>0&&(0,a.jsxs)("div",{className:"z-50 text-xs font-normal -mx-2 md:-mx-5 p-5 mt-10 text-gray-600 bg-neutral-200/40 flex flex-col md:flex-row justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["Results For Last Run Completed On",(0,a.jsx)("span",{className:"font-bold text-black",children:g?new Date(Number(g.created_at)).toLocaleString():"-"})]}),(0,a.jsx)("div",{className:"flex items-center gap-3 mt-2 md:mt-0 relative",children:(0,a.jsx)("div",{ref:O,className:"relative",children:(0,a.jsx)(G,{options:W,selected:null==g?void 0:g.id,onSelect:e=>{p(d.find(t=>t.id===e)||null)},placeholder:"Run",widthClass:"w-48"})})})]}),(0,a.jsx)("div",{className:"p-4 bg-white fontDmSans",children:!x&&!j&&P&&(0,a.jsxs)("div",{className:"flex flex-col md:grid md:grid-cols-2 gap-8 items-start",children:[(0,a.jsx)(l,{header:"Share Of Voice",children:(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4",children:(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-2 gap-4",children:Q.map(e=>(0,a.jsxs)("div",{className:"bg-primary rounded-lg py-4 px-3 flex flex-col justify-center min-h-[80px]",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("div",{className:"w-1 h-4 bg-indigo-400 rounded-2xl mr-2"}),(0,a.jsx)("span",{className:"textPrimary500 text-xs font-medium",children:e.label})]}),(0,a.jsx)("div",{className:" text-zinc-900 text-base font-semibold",children:e.value})]},e.label))})})}),(0,a.jsx)("div",{className:"border-0 md:border-l-[0.8px] border-neutral-200 w-full flex flex-col items-start justify-center md:pl-5 mb-8 md:mb-0",children:(0,a.jsx)(l,{header:"Brand Visibility Index",subheader:"Top 10 brands ranked by SOV",children:(0,a.jsx)("div",{className:"w-full overflow-x-auto max-h-[320px] overflow-y-auto scrollbar-hide",children:(0,a.jsxs)("table",{className:"w-full text-xs min-w-[340px]",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-gray-400",children:[(0,a.jsx)("th",{className:"text-left text-slate-500 text-xs font-normal"}),(0,a.jsx)("th",{className:"text-left text-slate-500 text-xs font-normal",children:"Brands"}),(0,a.jsx)("th",{className:"text-left text-slate-500 text-xs font-normal",children:"SOV"}),(0,a.jsx)("th",{className:"text-left text-slate-500 text-xs font-normal",children:"Questions"})]})}),(0,a.jsx)("tbody",{children:(()=>{var e,t;let s=(null==T?void 0:null===(e=T.result)||void 0===e?void 0:e.others)||[],n=(null==T?void 0:null===(t=T.result)||void 0===t?void 0:t.own)?{name:T.result.own.name||F,sov:T.result.own.sov,mentions:Array.isArray(T.result.own.queries)?T.result.own.queries.length:T.result.own.mentions||0}:null;return[...s.map(e=>({name:e.name,sov:e.sov,mentions:Array.isArray(e.queries)?e.queries.length:e.mentions||0}))||[],...n?[n]:[]].sort((e,t)=>(t.sov||0)-(e.sov||0)).slice(0,10).map((e,t)=>{var s;return(0,a.jsxs)("tr",{className:"text-[#222] font-medium",children:[(0,a.jsx)("td",{children:t+1}),(0,a.jsxs)("td",{className:"py-1",children:[" ",e.name]}),(0,a.jsx)("td",{className:"py-1 font-bold",children:void 0!==e.sov?"".concat(Number(e.sov).toFixed(2),"%"):"-"}),(0,a.jsx)("td",{className:"py-1",children:null!==(s=e.mentions)&&void 0!==s?s:"-"})]},e.name)})})()})]})})})})]})})]})]})}},42059:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(37876),n=s(14232),l=s(89099),r=s(43598);let i=()=>{let e=(0,l.useRouter)(),t=e.asPath,[s,i]=(0,n.useState)("aeo"),o=t.split("/").filter(e=>!(""===e||e.startsWith("?")||e.startsWith("#"))).map(e=>"aeo"===e?s:e),d=o.map((n,l)=>{let r=l===o.length-1;return(0,a.jsxs)("div",{className:"inline",children:[(0,a.jsx)("span",{className:"text-[#737373] font-medium capitalize cursor-pointer hover:underline",onClick:()=>{if(r)return;let a=o.slice(0,l+1),n="/".concat(a.map(e=>e===s?1===a.length?"/query/summary":"aeo":e).join("/"));n!==t&&n!=="/".concat(o[0])&&e.push(n)},children:n.replace(/-/g," ")}),!r&&(0,a.jsx)("span",{className:"text-[#737373] font-medium",children:" > "})]},l)});return(0,n.useEffect)(()=>{(async()=>{let e=await r.A.currentAeoProject();e&&i(e.name)})()},[]),(0,a.jsx)("div",{children:d})},o=e=>{let{children:t,title:s}=e;return(0,a.jsxs)("div",{className:"w-full bg-white border-b-[1px] border-gray-200 p-4 flex justify-between items-center gap-4 flex-wrap sticky top-0 z-20",children:[s||(0,a.jsx)(i,{}),t&&(0,a.jsx)("div",{className:"flex gap-4 items-center justify-between",children:t})]})}},49305:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/query/summary",function(){return s(8824)}])},94344:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var a=s(14232);let n=(e,t)=>{(0,a.useEffect)(()=>{let s=s=>{!e.some(e=>e.current&&e.current.contains(s.target))&&t(s)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[e,t])}}},e=>{var t=t=>e(e.s=t);e.O(0,[5711,7141,9034,7092,740,9325,3518,1153,542,636,6593,8792],()=>t(49305)),_N_E=e.O()}]);