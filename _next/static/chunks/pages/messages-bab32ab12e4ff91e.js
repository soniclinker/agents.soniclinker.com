(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5876],{7492:(e,t,s)=>{"use strict";s.d(t,{$:()=>l});var a=s(37876);s(14232);var n=s(69241),i=s(95313);let r={default:"bg-gray-500 hover:bg-gray-600 text-white",white:"bg-white hover:bg-gray-100 text-indigo-700 border border-indigo-700",primary:"bgHardBlue hover:bgHardBlue text-white",danger:"bg-red-600 hover:bg-red-700 text-white"},l=e=>{let{variant:t="default",loading:s=!1,children:l,className:o,loaderIcon:d,...c}=e;return(0,a.jsx)("button",{className:(0,n.A)(" text-xs font-semibold px-4 py-2 rounded-lg transition cursor-pointer flex items-center justify-center gap-2",r[t],o),disabled:s||c.disabled,...c,children:s?d||(0,a.jsx)(i.A,{className:"h-4 w-4 animate-spin"}):l})}},16821:(e,t,s)=>{"use strict";s.d(t,{A:()=>u});var a=s(42874),n=s(80498),i=s(3176),r=s(65259),l=s(20318);let o=()=>i.A.apiUrl+"/connect/update";class d{static getInstance(e){return(0,a._)(d,d,c)||(0,n._)(d,d,c,new d(e)),(0,a._)(d,d,c)}setOrgId(e){this.orgId=e}on(e,t){this.listener.add(t),"not_connected"===this.status&&this.connect()}off(e){this.listener.remove(e)}setupPing(){setTimeout(()=>{this.socket&&this.socket.readyState===WebSocket.OPEN&&(this.socket.send("{}"),this.setupPing())},3e4)}connect(){if("not_connected"!==this.status)return;this.changeStatus("connecting");let e=[],t=r.A.token();t&&e.push("access_token="+t),this.orgId&&e.push("org_id="+this.orgId);let s=e.length?"?"+e.join("&"):"";this.socket=new WebSocket(o()+s),this.socket.addEventListener("open",()=>{this.changeStatus("connected"),this.setupPing()}),this.socket.addEventListener("close",()=>{this.changeStatus("not_connected"),console.log("WebSocket closed")}),this.socket.addEventListener("message",e=>{try{let t=JSON.parse(e.data);this.listener.trigger(t)}catch(t){console.error("Invalid WebSocket message:",e.data)}})}send(e){this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify(e))}disconnect(){if(this.socket)try{this.socket.close()}catch(e){console.error("Error closing WebSocket:",e)}}changeStatus(e){this.status!==e&&(this.status=e)}constructor(e){this.status="not_connected",this.socket=null,this.orgId=e,this.listener=new l.A}}var c={writable:!0,value:null};let u=d},34648:(e,t,s)=>{"use strict";s.d(t,{g:()=>a});let a=e=>{let t=(Math.floor(Date.now())-e)/1e3,s={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60};for(let e in s){let a=Math.floor(t/s[e]);if(a>0)return"".concat(a," ").concat(e).concat(1!==a?"s":""," ago")}return"Just now"}},58951:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>$});var a=s(37876),n=s(14232),i=s(54587),r=s.n(i),l=s(43666),o=s(43598),d=s(65259);let c=e=>{let{tabs:t,activeTab:s,handleBtnClick:n,isActiveShow:i=!0}=e;return(0,a.jsx)(a.Fragment,{children:t.map((e,t)=>(0,a.jsxs)("button",{className:"flex items-center gap-[8px] font-medium cursor-pointer p-2 hover:bg-slate-500 rounded hover:text-white ".concat(i?s===e.key?"textPrimary":"textPrimary500":e.color?e.color:"textPrimary500"),onClick:()=>{n(e)},children:[e.icon?e.icon:""," ",e.name]},t))})};var u=s(94344),h=s(89099),m=s(20318),x=s(82400);let p={loading:"loading",loading_more:"loading_more",loaded:"loaded",error:"error"};class g{async fetchPage(){let e=this.queryConditions.join("&"),t="".concat(e,"&offset=").concat(25*this.curPage,"&limit=").concat(25);this.curPage>0?this.state=p.loading_more:this.state=p.loading,this.currentFetchId++;let s=this.currentFetchId;this.listeners.trigger({threads:this.threads,state:this.state});let{data:a,error:n}=await d.A.doGet({path:"orgs/".concat(o.A.currentId(),"/data/threads?").concat(t)});if(s===this.currentFetchId){if(n){this.state=p.error,this.hasMorePages=!1,this.listeners.trigger({threads:this.threads,state:this.state});return}a&&a.threads?(this.threads=this.threads.concat(a.threads),this.hasMorePages=a.threads.length>=25):(this.threads=[],this.hasMorePages=!1),this.state=p.loaded,this.listeners.trigger({threads:this.threads,state:this.state})}}async fetchThreads(){this.curPage=0,this.hasMorePages=!0,this.threads=[],this.queryConditions=["category=text"],this.mentioned?this.queryConditions.push("mentioned=me"):this.assigned&&this.queryConditions.push("assigned_to=".concat(x.A.current().user_id)),this.unread?this.queryConditions.push("seen=false"):this.highPriority?this.queryConditions.push("priority=high"):this.generalPriority&&this.queryConditions.push("priority=general"),this.channel&&this.queryConditions.push("channel=".concat(this.channel)),await this.fetchPage()}addListener(e){"function"==typeof e&&this.listeners.add(e)}removeListener(e){"function"==typeof e&&this.listeners.remove(e)}setAssignedFilter(){this.assigned=!0,this.mentioned=!1,this.fetchThreads()}setMentionedFilter(){this.mentioned=!0,this.assigned=!1,this.fetchThreads()}removeFilter(){this.assigned=!1,this.mentioned=!1,this.fetchThreads()}setUnread(){this.unread=!0,this.highPriority=!1,this.generalPriority=!1,this.fetchThreads()}setHighPriority(){this.highPriority=!0,this.unread=!1,this.generalPriority=!1,this.fetchThreads()}setGeneralPriority(){this.generalPriority=!0,this.unread=!1,this.highPriority=!1,this.fetchThreads()}setAll(){this.unread=!1,this.highPriority=!1,this.generalPriority=!1,this.fetchThreads()}selectChannel(e){this.channel=e,this.fetchThreads()}removeChannel(){this.channel="",this.fetchThreads()}async addPage(){this.state===p.loaded&&this.hasMorePages&&0!==this.queryConditions.length&&0!==this.threads.length&&(this.curPage++,this.fetchPage())}async init(){this.assigned=!1,this.mentioned=!1,this.unread=!1,this.highPriority=!1,this.generalPriority=!1,this.channel="",this.threads=[],this.curPage=0,this.hasMorePages=!0,this.queryConditions=[],this.fetchThreads()}constructor(){this.assigned=!1,this.mentioned=!1,this.unread=!1,this.highPriority=!1,this.generalPriority=!1,this.channel="",this.threads=[],this.curPage=0,this.hasMorePages=!0,this.currentFetchId=0,this.listeners=new m.A,this.queryConditions=[],this.state=p.loading}}var v=s(16821);let f=[{name:"Assigned to me",key:"assignedToMe"},{name:"Mentioned",key:"mentioned"},{name:"Remove Filter",key:""}],y=e=>{let{activePage:t,isMobileView:s,setActivePage:i,messages:m,setMessages:x}=e,[p,y]=(0,n.useState)("All"),[b,j]=(0,n.useState)(""),[N,w]=(0,n.useState)([]),[k,_]=(0,n.useState)(null),[S,E]=(0,n.useState)(""),[C,A]=(0,n.useState)(!1),[O,P]=(0,n.useState)(""),F=(0,n.useRef)(new g).current,M=(0,h.useRouter)(),{thread_id:D}=M.query,T=(0,n.useRef)(null);(0,u.A)([T],()=>J(!1));let[I,J]=(0,n.useState)(!1),[B,R]=(0,n.useState)(f),[L,U]=(0,n.useState)(""),q={instagram:l.Rj,whatsapp:l.b_,fbpage:l.kp},z=[{name:"WhatsApp",value:"whatsapp"},{name:"Facebook",value:"fbpage"},{name:"Instagram",value:"instagram"}],H=o.A.currentId(),Y=e=>{let t=(Math.floor(Date.now())-e)/1e3,s={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60};for(let e in s){let a=Math.floor(t/s[e]);if(a>0)return"".concat(a," ").concat(e).concat(1!==a?"s":""," ago")}return"Just now"},X=async e=>{try{if(!e.id||e.seen)return;let{data:t,error:s}=await d.A.doPost({path:"orgs/".concat(H,"/data/threads/").concat(e.id),data:{action:"set_seen"}});s&&(P(s.message),setTimeout(()=>P(""),2e3),console.error("Error updating seen status:",s))}catch(e){console.error("Error updating seen status:",e)}},W=e=>{V(),b===e?(F.removeChannel(),j("")):(F.selectChannel(e),j(e))},G=e=>{i("Message"),_(e.id),X(e);let t=e.id;M.push({pathname:M.pathname,query:{...M.query,thread_id:t}},void 0,{shallow:!0})},V=()=>{_(null),setTimeout(()=>{M.replace({pathname:M.pathname,query:{}},void 0,{shallow:!0})},0)},Z=e=>{V(),y(e),"High Priority"===e?F.setHighPriority():"General"===e?F.setGeneralPriority():"Unread"===e?F.setUnread():F.setAll()},K=e=>{if(!e||"string"!=typeof e)return"";let t=e.match(/@\[(.*?)\]\(id:.*?\)\s?(.*)/);return t?"@".concat(t[1]," ").concat(t[2]):e},$=e=>!!e&&z.map(e=>e.value).includes(e),Q=()=>{F.addPage()};return(0,n.useEffect)(()=>{let e=e=>{let{threads:t,state:s}=e;w(t),A("loading"===s||"loading_more"===s),P("error"===s?"Failed to load threads":"")};return F.addListener(e),F.init(),()=>{F.removeListener(e)}},[]),(0,n.useEffect)(()=>{let e=e=>{let t=e.target;t.scrollHeight-t.scrollTop<=t.clientHeight+300&&!C&&N.length>0&&Q()},t=document.querySelector(".threads-container");if(t)return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[C,N.length]),(0,n.useEffect)(()=>{console.log("MessagesList messages:",m),w(e=>{var t,s;let a=[...e],n=a.find(e=>e.id===D),i=a.findIndex(e=>e.id===D),r=Object.keys(m).find(e=>e.includes("Today"));if(!r)return a;let l=null===(t=m[r])||void 0===t?void 0:t[m[r].length-1];if(n){n.last_active_at=l.time;let e=JSON.parse((null===(s=n.last_message)||void 0===s?void 0:s.data)||"{}");e.message.content=JSON.parse(l.data).message.content,n.last_message.data=JSON.stringify(e),a[i]=n}return a.sort((e,t)=>{let s=Number(e.last_active_at)||0;return(Number(t.last_active_at)||0)-s}),a})},[H,m]),(0,n.useEffect)(()=>{(D||!(N.length>0)||"Threads"!==t||!s)&&(!D&&N.length>0&&"Threads"===t||D&&N.length>0&&(_(D),i("Message")))},[D,N,M]),(0,n.useEffect)(()=>{let e=v.A.getInstance(H),t=e=>{if("thread_updated"===e.type){let t="text",s=JSON.parse(e.data.last_message),a=Object.keys(s.message);a.includes("content")?t="text":a.includes("mime_type")&&(s.message.mime_type.includes("image")?t="image":s.message.mime_type.includes("video")?t="video":s.message.mime_type.includes("application")&&(t="document")),w(s=>{var a;let n=[...s],i=n.findIndex(t=>t.id===e.thread_id);return -1===i?s:(n[i]={...n[i],last_active_at:e.data.last_active_at,data:JSON.stringify({sender_name:null===(a=e.data.data)||void 0===a?void 0:a.sender_name}),last_message:{type:t,data:e.data.last_message}},n.sort((e,t)=>{let s=Number(e.last_active_at)||0;return(Number(t.last_active_at)||0)-s}),n)})}else"thread_created"===e.type&&w(t=>{var s;if(t.find(t=>t.id===e.thread_id))return t;let a=[...t];return[{...e.data,data:JSON.stringify({sender_name:null===(s=JSON.parse(e.data.data))||void 0===s?void 0:s.sender_name})},...a]})};return e.on("message",t),()=>{e.off(t)}},[H]),(0,a.jsxs)("div",{className:"p-4 bg-white shadow-md text-xs overflow-auto relative pt-0 threads-container ".concat(s&&"Threads"===t?"w-full":"w-1/2"),children:[O&&(0,a.jsx)("div",{className:"w-[-webkit-fill-available] absolute text-white mx-[20px] z-[6]",children:(0,a.jsxs)("div",{className:"flex justify-around px-[10px] py-[4px] bg-red-500 rounded max-w-[290px] m-auto",children:[(0,a.jsx)("div",{children:O}),(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>P(""),children:"x"})]})}),(0,a.jsxs)("div",{className:"sticky top-0 bg-white z-6 pt-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"font-bold text-black text-sm flex-none",children:"Recent Messages"}),(0,a.jsxs)("div",{className:"flex justify-end items-center gap-x-2 relative text-[#64748A] w-full",children:[L&&B.filter(e=>e.key==L)[0].name,(0,a.jsx)(r(),{src:l.pb,width:24,height:24,alt:"Filter",onClick:()=>J(!I),className:"mr-2 cursor-pointer"}),I&&(0,a.jsx)("nav",{ref:T,className:"flex w-max flex-col absolute top-[42px] z-50 rounded-sm p-2 border-[0.4px] border-[#CAD4E0] bg-white shadow-[box-shadow: 0px 8px 10px -6px rgba(0, 0, 0, 0.10), 0px 20px 25px -5px rgba(0, 0, 0, 0.10)]",children:(0,a.jsx)(c,{tabs:B,activeTab:L,handleBtnClick:e=>{U(e.key),J(!1),V(),"assignedToMe"===e.key?F.setAssignedFilter():"mentioned"===e.key?F.setMentionedFilter():F.removeFilter(),E(e.key)},isActiveShow:!1})})]})]}),(0,a.jsx)("div",{className:"flex items-center mt-[16px] gap-[10px] mb-[15px] overflow-auto flex-wrap",children:[{name:"All",value:null},{name:"High Priority",color:"#F33F5E",value:0},{name:"General",color:"#2563EA",value:1},{name:"Unread",color:"#16A24A"}].map(e=>(0,a.jsxs)("div",{className:"flex text-xs items-center justify-center p-[12px] gap-[6px] w-fit min-w-[77px] h-[25px] font-normal rounded-sm cursor-pointer",onClick:()=>Z(e.name),style:{backgroundColor:p===e.name?"#EDF1FE":"transparent",color:p===e.name?"#4F46E4":"#A2A2A2"},children:[e.color&&(0,a.jsx)("span",{className:"w-[4px] h-[4px] rounded-full ",style:{backgroundColor:e.color}}),(0,a.jsx)("span",{className:"whitespace-nowrap ",children:e.name})]},e.name))}),(0,a.jsx)("div",{className:"w-full h-px ",style:{backgroundColor:"#D3D3D3"}}),(0,a.jsx)("div",{className:"flex gap-[9px] items-center overflow-x-auto scrollbar-none h-[60px] flex-wrap",children:z.map((e,t)=>(0,a.jsx)("div",{className:"px-3 py-1 w-fit rounded-2xl cursor-pointer ".concat(b===e.value?"bgSoftBlue textPrimary":"bgPrimary100 textPrimary500"),onClick:()=>W(e.value),children:e.name},"".concat(e.value+t)))})]}),(0,a.jsx)("div",{className:"bg-[#F7F9FB]",children:C&&0===N.length?(0,a.jsx)("div",{className:"text-center py-4",children:"Loading threads..."}):(0,a.jsxs)(a.Fragment,{children:[N.map((e,t)=>{var s;return(0,a.jsxs)("div",{className:"text-[#737373] flex gap-[13px] items-center h-20 px-6 py-4 cursor-pointer ".concat(k===e.id?"bgSoftBlue":""),onClick:()=>G(e),children:[(0,a.jsxs)("div",{className:"relative w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center cursor-pointer min-w-[40px] min-h-[40px]",children:[(0,a.jsx)(r(),{src:l.ff,height:24,width:24,alt:"User-icon"}),$(e.channel)&&(0,a.jsx)("span",{className:"absolute bottom-[0px] left-[0px] bg-white rounded-2xl",children:(0,a.jsx)(r(),{src:q[null==e?void 0:e.channel],height:16,width:16,alt:"channel"})})]}),(0,a.jsxs)("div",{className:"flex flex-col overflow-hidden ",children:[(0,a.jsx)("div",{className:"text-black font-normal",children:(null===(s=JSON.parse(e.data))||void 0===s?void 0:s.sender_name)||""}),(0,a.jsx)("div",{className:"truncate w-full",children:(()=>{var t,s,a,n;switch(null==e?void 0:null===(t=e.last_message)||void 0===t?void 0:t.type){case"text":return K((null===(a=JSON.parse((null==e?void 0:null===(n=e.last_message)||void 0===n?void 0:n.data)||"{}"))||void 0===a?void 0:null===(s=a.message)||void 0===s?void 0:s.content)||"");case"video":return"Video";case"image":return"Image";case"document":return"Document";default:return""}})()})]}),(0,a.jsx)("div",{className:"ml-auto h-[44px] flex justify-start items-start",children:(0,a.jsxs)("div",{className:"flex items-center gap-[12px]",children:[(0,a.jsx)("span",{className:"min-w-[72px] text-neutral-500 text-xs font-normal",children:Y(Number(e.last_active_at))}),(0,a.jsx)("div",{className:"w-[8px] h-[8px] rounded-full ".concat(e.priority?"bg-[#2563EA]":"bg-[#F33F5E]"),children:" "})]})})]},"".concat((null==e?void 0:e.id)+t))}),C&&N.length>0&&(0,a.jsx)("div",{className:"text-center py-4",children:"Loading more..."})]})}),0===N.length&&!C&&(0,a.jsx)("div",{className:"flex justify-center my-[10px]",children:"No messages available."})]})};var b=s(77929),j=s.n(b),N=s(26478),w=s(7972),k=s(45732),_=s(74562),S=s(24814);let E={control:{backgroundColor:"#fff",fontSize:14,fontWeight:"normal"},"&multiLine":{control:{fontFamily:"monospace",minHeight:80},highlighter:{padding:9,border:"1px solid transparent"},input:{padding:9,border:"1px solid silver"}},"&singleLine":{display:"inline-block",width:180,highlighter:{padding:1,border:"2px inset transparent"},input:{padding:1,border:"2px inset"}},suggestions:{list:{backgroundColor:"white",border:"1px solid rgba(0,0,0,0.15)",fontSize:14},item:{padding:"5px 15px",borderBottom:"1px solid rgba(0,0,0,0.15)","&focused":{backgroundColor:"#cee4e5"}}}},C=e=>{let{onClose:t,thread:s}=e,[i,r]=(0,n.useState)(""),[l,c]=(0,n.useState)([]),[u,h]=(0,n.useState)(""),m=o.A.currentId(),x=(0,n.useCallback)(async()=>{try{let{data:e,error:t}=await d.A.doGet({path:"/orgs/".concat(m,"/users")});if(t){h(t.message),setTimeout(()=>{h("")},2e3),console.error("Error fetching users:",t);return}c((null==e?void 0:e.users)||[])}catch(e){console.error("Error fetching users:",e)}},[m]),p=async(e,a,n)=>{try{if(!s.id)return;let{data:i,error:r}=await d.A.doPost({path:"orgs/".concat(m,"/data/threads/").concat(s.id),data:{action:"comment",message:e||"",assign_to:a||null,mentions:n||null}});if(r){h(r.message),setTimeout(()=>{h("")},2e3),console.error("Error fetching invited users:",r);return}t(e)}catch(e){console.error("Error fetching invited users:",e)}},g=e=>{let t;let s=/@\[(.*?)\]\(id:(.*?)\)/g,a=[];for(;null!==(t=s.exec(e));)a.push({name:t[1],id:t[2]});return a},v=async()=>{let e=g(i).map(e=>e.id);if(i&&i.length>0)try{await p(i,e[0]||null,e)}catch(e){console.error("Error assigning user:",e)}};return(0,n.useEffect)(()=>{x()},[x]),(0,a.jsxs)("div",{className:"flex flex-col gap-[16px]",children:[u&&(0,a.jsx)("div",{className:"w-lg lg:w-xl absolute text-white z-[6]",children:(0,a.jsxs)("div",{className:"flex justify-around  px-[10px] py-[4px] bg-red-500 rounded max-w-[290px] m-auto",children:[(0,a.jsx)("div",{children:u}),(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>h(""),children:"x"})]})}),(0,a.jsx)("div",{className:"h-[0.6px] bg-[#E1E7EF]"}),(0,a.jsx)("div",{className:"text-[#64748A]",children:"Assign a particular conversation to a particular user. Add the task too. Tasks are visible to you and the admin only."}),(0,a.jsx)("div",{className:"relative w-full max-w-lg p-4",children:(0,a.jsx)(S.G,{value:i,onChange:e=>r(e.target.value),style:E,placeholder:"Mention people using '@'",a11ySuggestionsListLabel:"Suggested mentions",children:(0,a.jsx)(S.P,{markup:"@[__display__](id:__id__)",trigger:"@",data:l.map(e=>({id:e.id,display:e.name})),displayTransform:(e,t)=>"@".concat(t),renderSuggestion:(e,t,s,n,i)=>(0,a.jsx)("div",{className:"user ".concat(i?"focused":""),children:s}),style:{backgroundColor:"#cee4e5"}})})}),(0,a.jsxs)("div",{className:"flex justify-end gap-[8px]",children:[(0,a.jsx)("button",{className:"text-[14px] font-semibold py-[10px] px-[14px] text-[#334155] bg-[#F0F4F8] rounded-sm",onClick:()=>t(""),children:"Cancel"}),(0,a.jsx)("button",{className:"text-[14px] font-semibold py-[10px] px-[14px] text-white bg-[#4F46E4] rounded-sm",onClick:v,children:"Assign"})]})]})};var A=s(13216),O=s(75683),P=s(68214),F=s(18847),M=s.n(F);let D=e=>{let{template:t,templateName:s,getLatestInputs:i}=e,l=(0,n.useRef)(""),o=JSON.stringify(t),d=l.current!==o,c=(0,n.useMemo)(()=>t.find(e=>"BODY"===e.type),[t]),u=(0,n.useMemo)(()=>{var e;return(null==c?void 0:null===(e=c.example)||void 0===e?void 0:e.body_text_named_params)||[]},[c]),h=(0,n.useMemo)(()=>{var e,t;return(null==c?void 0:null===(t=c.example)||void 0===t?void 0:null===(e=t.body_text)||void 0===e?void 0:e[0])||[]},[c]),m=(0,n.useMemo)(()=>{let e=[];return(null==c?void 0:c.text)&&[...c.text.matchAll(/{{(\d+)}}/g)].forEach(t=>{let s=t[1];e.includes(s)||e.push(s)}),e},[c]),x=(0,n.useMemo)(()=>t.find(e=>"HEADER"===e.type),[t]),p=(0,n.useMemo)(()=>{var e;return(null==x?void 0:null===(e=x.example)||void 0===e?void 0:e.header_text_named_params)||[]},[x]),g=(0,n.useMemo)(()=>{var e,t;return(null==x?void 0:null===(t=x.example)||void 0===t?void 0:null===(e=t.header_text)||void 0===e?void 0:e[0])||[]},[x]),v=(0,n.useMemo)(()=>{let e=[];return(null==x?void 0:x.text)&&[...x.text.matchAll(/{{(\d+)}}/g)].forEach(t=>{let s=t[1];e.includes(s)||e.push(s)}),e},[x]),f=(0,n.useMemo)(()=>u.reduce((e,t)=>(e[t.param_name]=t.example||"",e),{}),[u]),y=(0,n.useMemo)(()=>p.reduce((e,t)=>(e[t.param_name]=t.example||"",e),{}),[p]),b=(0,n.useMemo)(()=>{let e={};return m.forEach((t,s)=>{e[t]=h[s]||""}),e},[m,h]),j=(0,n.useMemo)(()=>{let e={};return v.forEach((t,s)=>{e[t]=g[s]||""}),e},[v,g]),[N,w]=(0,n.useState)(y),[k,_]=(0,n.useState)(f),[S,E]=(0,n.useState)(j),[C,A]=(0,n.useState)(b),O=(e,t)=>{_(s=>{let a={...s,[e]:t};return i(a,"BODY"),a})},P=(e,t)=>{w(s=>{let a={...s,[e]:t};return i(a,"HEADER"),a})},F=(e,t)=>{A(s=>{let a={...s,[e]:t};return i(a,"BODY-INDEX"),a})},M=(e,t)=>{E(s=>{let a={...s,[e]:t};return i(a,"HEADER-INDEX"),a})};(0,n.useEffect)(()=>{d&&(w(y),_(f),E(j),A(b),i(f,"BODY"),i(y,"HEADER"),i(b,"BODY-INDEX"),i(j,"HEADER-INDEX"),l.current=o)},[o,d,f,y,b,j,i]);let D=e=>e.text.replace(/{{(.*?)}}/g,(e,t)=>{let s=t.trim();return/^\d+$/.test(s)?C[s]||"{{".concat(s,"}}"):k[s]||"{{".concat(s,"}}")}),T=e=>{var t,s,n;if("IMAGE"===e.format){let t=null==e?void 0:null===(s=e.example)||void 0===s?void 0:s.header_handle;if(t&&t.length>0)return t.map((e,t)=>(0,a.jsx)(r(),{src:e,alt:"Template Image",width:100,height:120,className:"w-full h-[120px]"},t))}if("VIDEO"===e.format){let t=null==e?void 0:null===(n=e.example)||void 0===n?void 0:n.header_handle;if(t&&t.length>0)return t.map((e,t)=>(0,a.jsxs)("video",{controls:!0,className:"w-full h-[120px]",children:[(0,a.jsx)("source",{src:e,type:"video/mp4"}),"Your browser does not support the video tag."]},"".concat(t,"-").concat(e)))}return null===(t=e.text)||void 0===t?void 0:t.replace(/{{(.*?)}}/g,(e,t)=>{let s=t.trim();return/^\d+$/.test(s)?S[s]||"{{".concat(s,"}}"):N[s]||"{{".concat(s,"}}")})};return(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-[20px]",children:[(u.length>0||p.length>0||m.length>0||v.length>0)&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Fill Template Values:"}),(p.length>0||v.length>0)&&(0,a.jsx)("p",{className:"text-md font-semibold mb-[0px]",children:"Header Inputs:"}),p.map(e=>{let{param_name:t}=e;return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{className:"font-medium capitalize",children:t}),(0,a.jsx)("input",{type:"text",value:N[t]||"",onChange:e=>P(t,e.target.value),className:"p-2 border border-gray-300 rounded-md",placeholder:"Enter ".concat(t)})]},t)}),v.map(e=>(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("label",{className:"font-medium",children:["Parameter ",e]}),(0,a.jsx)("input",{type:"text",value:S[e]||"",onChange:t=>M(e,t.target.value),className:"p-2 border border-gray-300 rounded-md",placeholder:"Enter value for parameter ".concat(e)})]},"header-".concat(e))),(u.length>0||m.length>0)&&(0,a.jsx)("p",{className:"text-md font-semibold mb-[0px]",children:"Body Inputs:"}),u.map(e=>{let{param_name:t}=e;return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{className:"font-medium capitalize",children:t}),(0,a.jsx)("input",{type:"text",value:k[t]||"",onChange:e=>O(t,e.target.value),className:"p-2 border border-gray-300 rounded-md",placeholder:"Enter ".concat(t)})]},t)}),m.map(e=>(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("label",{className:"font-medium",children:["Parameter ",e]}),(0,a.jsx)("input",{type:"text",value:C[e]||"",onChange:t=>F(e,t.target.value),className:"p-2 border border-gray-300 rounded-md",placeholder:"Enter value for parameter ".concat(e)})]},"body-".concat(e)))]}),(0,a.jsx)("div",{className:"font-[Urbanist] font-semibold p-4 grow bg-[#EDF1FE] border-[0.4px] border-[#4F46E4] rounded-md shadow text-black font-sans space-y-4",children:t.map((e,t)=>{switch(e.type){case"HEADER":return(0,a.jsx)("h2",{className:"text-lg font-bold",children:T(e)},t);case"BODY":return(0,a.jsx)("p",{className:"whitespace-pre-line",children:D(e)},t);case"FOOTER":return(0,a.jsx)("div",{className:"text-sm text-gray-700",children:e.text},t);default:return null}})})]})},T=e=>{let{onClose:t,thread:s}=e,[i,r]=(0,n.useState)([]),[l,c]=(0,n.useState)({}),[u,h]=(0,n.useState)(""),m=o.A.currentId(),[x,p]=(0,n.useState)({}),[g,v]=(0,n.useState)({}),[f,y]=(0,n.useState)({}),[b,j]=(0,n.useState)({}),N=async()=>{let{data:e,error:t}=await d.A.doGet({path:"orgs/".concat(m,"/whatsapp/templates")});if(t){h(t.message),setTimeout(()=>{h("")},2e3),console.error("Error fetching invited users:",t);return}r((null==e?void 0:e.templates)||[])},w=async(e,a,n,i)=>{let{data:r,error:o}=await d.A.doPost({path:"orgs/".concat(m,"/data/threads/").concat(s.id),data:{action:"send_message",template_name:l.name,body_inputs:e,header_inputs:a,body_index:n,header_index:i}});if(o){h(o.message),setTimeout(()=>{h("")},2e3),console.error("Error fetching invited users:",o);return}t({msg:function(e,t){let s=e.components||[],a=t.body_inputs||{},n=t.body_index||{},i=t.header_inputs||{},r=t.header_index||{},l="";for(let e of s){var o,d,c,u,h,m,x;if("HEADER"===e.type&&"TEXT"===e.format){let t=e.text;if(Object.keys(e.example||{}).includes("header_text_named_params")){let s=null===(d=e.example)||void 0===d?void 0:null===(o=d.header_text_named_params)||void 0===o?void 0:o.map(e=>e.param_name);null==s||s.forEach(e=>{t=t.replace("{{".concat(e,"}}"),i[e])}),l+=t+"\n"}else((null===(u=e.example)||void 0===u?void 0:null===(c=u.header_text)||void 0===c?void 0:c.map((e,t)=>t+1))||[]).forEach(e=>{t=t.replace("{{".concat(e,"}}"),r[e])}),l+=t+"\n"}else if("BODY"===e.type){let t=e.text;if(Object.keys(e.example||{}).includes("body_text_named_params")){let s=null===(m=e.example)||void 0===m?void 0:null===(h=m.body_text_named_params)||void 0===h?void 0:h.map(e=>e.param_name);null==s||s.forEach(e=>{t=t.replace("{{".concat(e,"}}"),a[e])}),l+=t+"\n"}else((null===(x=e.example)||void 0===x?void 0:x.body_text[0].map((e,t)=>t+1))||[]).forEach(e=>{t=t.replace("{{".concat(e,"}}"),n[e])}),l+=t+"\n"}else"FOOTER"===e.type&&(l+=e.text)}return l}(l,{body_inputs:e,body_index:n,header_inputs:a,header_index:i}),id:r.message_id})};return(0,n.useEffect)(()=>{N()},[]),(0,a.jsxs)("div",{className:"flex flex-col gap-[14px] w-full",children:[u&&(0,a.jsx)("div",{className:"w-lg lg:w-xl absolute text-white z-[6]",children:(0,a.jsxs)("div",{className:"flex justify-around  px-[10px] py-[4px] bg-red-500 rounded max-w-[290px] m-auto",children:[(0,a.jsx)("div",{children:u}),(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>h(""),children:"x"})]})}),(0,a.jsxs)("div",{className:" flex flex-col gap-[20px]",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center gap-[4px] pt-2 relative",children:[(0,a.jsx)("label",{children:"Select Template:"}),(0,a.jsxs)("select",{id:"businesses",className:"appearance-none w-full max-w-xs px-4 py-2 bg-[#F7F9FB] text-gray-700 rounded-lg border-[0.4px] border-[#CAD4E0] shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 cursor-pointer",onChange:e=>{let t=e.target.value;if(0===i.length)return;c({});let s=i.find(e=>{let{id:s}=e;return s===t});y({}),j({}),p({}),v({}),c(s)},children:[!(null==l?void 0:l.id)&&(0,a.jsx)("option",{value:"",children:"Select Your Business"}),i.map(e=>{let{id:t,name:s}=e;return(0,a.jsx)("option",{value:t,children:s},t)})]}),(0,a.jsx)("div",{className:"top-[10px] pointer-events-none absolute inset-y-0 right-3 flex items-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 12a1 1 0 01-.7-.3l-4-4a1 1 0 111.4-1.4L10 9.6l3.3-3.3a1 1 0 011.4 1.4l-4 4a1 1 0 01-.7.3z",clipRule:"evenodd"})})})]}),(0,a.jsx)("div",{children:l&&Object.keys(l).length>0&&(0,a.jsx)(D,{template:l.components||[],templateName:l.name||"",getLatestInputs:(e,t)=>{switch(t){case"BODY":p(e);break;case"HEADER":v(e);break;case"BODY-INDEX":y(e);break;case"HEADER-INDEX":j(e)}}})})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-[10px]",children:[(0,a.jsx)("button",{className:"flex justify-center w-[80px] items-center gap-[8px] p-[4px] border-1 border-[#CAD4E0] text-[#000] bg-[#F0F4F8] rounded font-semibold cursor-pointer",onClick:async()=>{t({msg:"",id:""})},children:"Cancel"}),(0,a.jsx)("button",{className:"flex justify-center w-[80px] text-white items-center gap-[8px] p-[4px] rounded font-semibold ".concat(void 0===l.id?"bg-[#93A2B7] cursor-not-allowed":"bg-[#4F46E4] cursor-pointer"),onClick:async()=>{w(x,g,f,b)},disabled:void 0===l.id,children:"Send"})]})]})};var I=s(3176);let J=e=>{let{onClose:t,onConFirm:s}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-[14px]",children:[(0,a.jsx)("div",{className:"flex justify-start",children:"Are you sure you want to block the User?"}),(0,a.jsxs)("div",{className:"flex justify-end gap-[10px]",children:[(0,a.jsx)("button",{className:"flex justify-center w-[80px] items-center gap-[8px] p-[4px] border-1 text-[#000] bg-[#F0F4F8] rounded font-semibold cursor-pointer",onClick:async()=>t(),children:"Cancel"}),(0,a.jsx)("button",{className:"flex justify-center w-[80px] items-center gap-[8px] p-[4px] bg-[#4F46E4] rounded text-white font-semibold cursor-pointer",onClick:()=>s(),children:"Block"})]})]})},B=e=>{let{onClose:t,onConFirm:s}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-[14px]",children:[(0,a.jsx)("div",{className:"flex justify-start",children:"Are you sure you want to clear the chat?"}),(0,a.jsxs)("div",{className:"flex justify-end gap-[10px]",children:[(0,a.jsx)("button",{className:"flex justify-center w-[80px] items-center gap-[8px] border-1 p-[4 px] bg-[#F0F4F8] rounded text-black font-semibold cursor-pointer",onClick:async()=>t(),children:"Cancel"}),(0,a.jsx)("button",{className:"flex justify-center w-[80px] items-center gap-[8px] p-[4px] bg-[#4F46E4] rounded text-white font-semibold cursor-pointer",onClick:async()=>s(),children:"Clear"})]})]})};var R=s(21976);let L=e=>{let{contactBlocked:t,isAiEnabled:s,message:n,isMobileView:i,isMessageDropDownOPen:o,thread:d,setIsMessageDropDownOPen:c,handleTemplateForMessage:u,sendMessageHandler:h,updateBlockStatus:m,setIsAiEnabled:x,setIsAi:p,setMessage:g}=e;return(0,a.jsxs)("div",{className:"w-auto text-black text-[12px] m-2 relative",children:[!t&&(0,a.jsx)("div",{className:"absolute top-[4px] left-[20px]",children:(0,a.jsx)("div",{className:"flex items-center",children:t?"":s?(0,a.jsxs)("div",{children:["AI is enabled."," ",(0,a.jsx)("a",{className:"cursor-pointer underline font-semibold",onClick:()=>{x(!1),p(!1)},children:"Click here to disable"})]}):(0,a.jsxs)("div",{children:["AI is disabled."," ",(0,a.jsx)("a",{className:"cursor-pointer underline font-semibold",onClick:()=>{x(!0),p(!0)},children:"Click here to enable"})]})})}),(0,a.jsxs)("div",{className:"w-full flex items-center gap-[10px] p-[18px] pb-[8px] border border-[#CAD4E0] rounded-lg ".concat(t?"blur-[100px]":""),children:[(0,a.jsxs)("div",{className:"grow relative",children:[(0,a.jsx)("textarea",{className:"w-full mt-1 p-[11px] pr-[36px] scrollbar-hidden h-[44px] rounded-lg outline-none resize-none border-[0.5px] border-solid border-slate-300",placeholder:s?"Disable AI and send reply":"Enter the message",value:n,onChange:e=>g(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),h(0))}}),"whatsapp"==d.channel&&(0,a.jsx)("div",{className:"absolute top-[14px] right-[12px] text-[24px] bg-white textSecondary400 cursor-pointer",onClick:e=>{e.stopPropagation(),u()},children:(0,a.jsx)(R.YVP,{})})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("button",{className:"flex items-center gap-[8px] py-[10px] pl-[10px] pr-[10px] bg-[#4F46E4] rounded-full text-white font-semibold cursor-pointer relative",onClick:()=>h(0),children:[(0,a.jsx)("span",{children:"Send"}),(0,a.jsx)(r(),{src:l.tN,height:16,width:16,alt:"send-icon"})]})})]}),t&&(0,a.jsx)("div",{className:"flex justify-center w-full text-[16px] absolute top-[30px]",children:(0,a.jsx)("div",{onClick:async()=>m(!1),className:"bg-[#F0F4F8] px-2 py-1 rounded cursor-pointer",children:"You blocked this Contact. Tap to Unblock"})})]})};var U=s(59884);let q=e=>{let{src:t,alt:s="Image",className:i=""}=e,[l,o]=(0,n.useState)(!1),d=()=>{o(!l)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r(),{src:t,alt:s,width:150,height:200,className:"max-w-full transition-transform duration-200 ease-in-out object-cover hover:scale-[1.02] cursor-pointer ".concat(i),onClick:d,style:{maxWidth:"400px",maxHeight:"200px"}}),l&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-85 flex items-center justify-center z-50 animate-fadeIn",onClick:d,onKeyDown:e=>{"Escape"===e.key&&l&&o(!1)},tabIndex:0,children:(0,a.jsxs)("div",{className:"relative max-w-[90vw] max-h-[90vh]",children:[(0,a.jsx)("button",{className:"absolute -top-10 -right-10 bg-transparent border-none text-white text-4xl cursor-pointer z-[51]",onClick:e=>{e.stopPropagation(),d()},children:"\xd7"}),(0,a.jsx)(r(),{src:t,alt:s,width:500,height:400,className:"max-w-full max-h-[90vh] object-contain shadow-lg"})]})})]})},z=e=>{var t;let{orgId:s,mediaId:i,thread_id:o,content_type:c,filename:u="Document",filesize:h="",duration:m="",time:x="",by:p,status:g}=e,[v,f]=(0,n.useState)(null),[y,b]=(0,n.useState)(!1),j=d.A.token(),N=I.A.apiUrl,[w,k]=(0,n.useState)(!1);return y?(0,a.jsx)("div",{children:"Loading media..."}):c.startsWith("image/")?(0,a.jsx)("div",{className:"relative max-w-[320px] rounded-tl-2xl rounded-tr-2xl rounded-br-2xl ".concat("user"===p?"bgMediumBlue":"bg-neutral-200"," p-2 shadow-md flex justify-center items-center"),children:(0,a.jsx)(q,{src:"".concat(N,"/orgs/").concat(s,"/whatsapp/media/").concat(i,"?access_token=").concat(j,"&thread_id=").concat(o),alt:"WhatsApp Media",className:"rounded-2xl w-full h-auto max-h-[400px] object-contain"})}):c.startsWith("video/")?(0,a.jsxs)("div",{className:"relative w-[320px] h-[240px] rounded-tl-2xl rounded-tr-2xl rounded-br-2xl ".concat("user"===p?"bgMediumBlue":"bg-neutral-200"," p-2 flex flex-col justify-end shadow-md"),children:[(0,a.jsx)("video",{className:"w-full h-full object-cover rounded-2xl",src:"".concat(N,"/orgs/").concat(s,"/whatsapp/media/").concat(i,"?access_token=").concat(j,"&thread_id=").concat(o),poster:"",controls:!0,onPlay:()=>k(!0),onPause:()=>k(!1)}),!w&&(0,a.jsx)(U.GH9,{className:"absolute top-1/2 left-1/2 text-white text-5xl opacity-90 -translate-x-1/2 -translate-y-1/2 pointer-events-none"}),(0,a.jsx)("div",{className:"absolute bottom-3 left-3 text-white text-[18px] font-medium drop-shadow",children:m})]}):(0,a.jsx)("a",{href:"".concat(N,"/orgs/").concat(s,"/whatsapp/media/").concat(i,"?access_token=").concat(j,"&thread_id=").concat(o),target:"_blank",rel:"noopener noreferrer",className:"block w-[320px] rounded-tl-2xl rounded-tr-2xl rounded-br-2xl bg-[#5B4DF7] p-4 shadow-md",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:" w-14 h-12 px-3.5 py-3 bg-slate-200 rounded-lg inline-flex justify-start items-center",children:(0,a.jsx)(r(),{src:l.Eh,alt:"Folder",className:"text-4xl text-[#F7C948]"})}),(0,a.jsxs)("div",{className:"flex flex-col text-white",children:[(0,a.jsx)("span",{className:"self-stretch justify-start text-white text-sm font-medium truncate max-w-[180px]",children:u}),(0,a.jsxs)("span",{className:"textSecondary200 text-sm opacity-80",children:[h,h&&","," ",null===(t=c.split("/")[1])||void 0===t?void 0:t.toUpperCase()," File"]})]})]})})};var H=s(7492),Y=s(30412);let X=M()(()=>Promise.all([s.e(9923),s.e(3845),s.e(2736)]).then(s.bind(s,22736)),{loadableGenerated:{webpack:()=>[22736]},ssr:!1}),W=[{name:"View Contact Details",key:"profile",icon:(0,a.jsx)(w.JXP,{})},{name:"Assign Users",key:"assign-user",icon:(0,a.jsx)(w.Yh2,{})},{name:"Block Contact",key:"block-contact",icon:(0,a.jsx)(k.lXy,{})},{name:"Clear Chat",key:"clear-chat",icon:(0,a.jsx)(P.c8Z,{})}],G=e=>{var t;let{activePage:s,isMobileView:i,setActivePage:m,addMessageToList:x,thread:p,setThread:g,messages:f,setMessages:y,messagesContainerRef:b}=e,S=(0,h.useRouter)(),{thread_id:E}=S.query,[F,M]=(0,n.useState)(!1),[D,R]=(0,n.useState)(""),[U,q]=(0,n.useState)(!1),[G,V]=(0,n.useState)(!1),[Z,K]=(0,n.useState)(""),[$,Q]=(0,n.useState)(!0),[ee,et]=(0,n.useState)(!0),[es,ea]=(0,n.useState)(0),en=(0,n.useRef)(!1),ei=[{name:"WhatsApp",value:"whatsapp"},{name:"Facebook",value:"fbpage"},{name:"Instagram",value:"instagram"}],er=(0,n.useRef)(null);(0,u.A)([er],()=>q(!1));let[el,eo]=(0,n.useState)(W),ed=o.A.currentId(),ec=(0,n.useRef)(!1),eu={instagram:l.Rj,whatsapp:l.b_,fbpage:l.kp},[eh,em]=(0,n.useState)(null),ex=async()=>{if(!E){g({}),et(!1);return}let{data:e,error:t}=await d.A.doGet({path:"orgs/".concat(ed,"/data/threads/").concat(E)});if(t){K(t.message),(0,A.setTimeout)(()=>{K("")},2e3),console.error("Error fetching invited users:",t);return}e&&e.thread&&(g(e.thread),V("blocked"===e.thread.mode),Q("auto"===e.thread.mode||!e.thread.mode))},ep=async e=>{if(!E||en.current)return;en.current=!0;let{data:t,error:s}=await d.A.doGet({path:"orgs/".concat(ed,"/data/threads/").concat(E,"/messages?limit=25&offset=").concat(25*e)});if(s){K(s.message),(0,A.setTimeout)(()=>{K("")},2e3),console.error("Error fetching invited users:",s);return}t&&t.messages&&0!==t.messages.length&&(t.messages=t.messages.filter(e=>"assistant"===JSON.parse(e.data).message.role||"user"===JSON.parse(e.data).message.role)),t&&t.messages&&ew(t.messages.toReversed()),et(0!==t.messages.length),(0,A.setTimeout)(()=>{ec.current=!0,b&&b.current&&0==e&&(b.current.scrollTop=b.current.scrollHeight)},10),en.current=!1},eg=async e=>{Q(!e),await ev({action:"set_mode",mode:e?"blocked":"auto"}),e?(eo([{name:"View Contact Details",key:"profile",icon:(0,a.jsx)(w.JXP,{})},{name:"Assign Users",key:"assign-user",icon:(0,a.jsx)(w.Yh2,{})},{name:"Unblock Contact",key:"Unblock-contact",icon:(0,a.jsx)(k.lXy,{})},{name:"Clear Chat",icon:(0,a.jsx)(P.c8Z,{}),key:"clear-chat"}]),V(!0)):(eo([{name:"View Contact Details",key:"profile",icon:(0,a.jsx)(w.JXP,{})},{name:"Assign Users",key:"assign-user",icon:(0,a.jsx)(w.Yh2,{})},{name:"Block Contact",key:"block-contact",icon:(0,a.jsx)(k.lXy,{})},{name:"Clear Chat",icon:(0,a.jsx)(P.c8Z,{}),key:"clear-chat"}]),V(!1))},ev=async e=>{try{if(!p.id)return;let{data:t,error:s}=await d.A.doPost({path:"orgs/".concat(ed,"/data/threads/").concat(p.id),data:e});if(s){K(s.message),(0,A.setTimeout)(()=>{K("")},2e3),console.error("Error fetching invited users:",s);return}"send_message"===e.action&&(Q(!1),x({msg:e.message,id:t.message_id},"text")),"delete_messages"===e.action&&(y({}),ea(0))}catch(e){K(e.message),console.error("Error fetching :",e)}},ef=async e=>{D&&(await ev({action:"send_message",message:D}),R(""))},ey=e=>new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});function eb(e){let t;let s=new Date(e),a=new Date,n=new Date(s.getFullYear(),s.getMonth(),s.getDate()),i=Math.floor((new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()-n.getTime())/864e5);if(0===i)t="Today";else if(1===i)t="Yesterday";else if(i<=6)t="".concat(i," days ago");else if(i<=29){let e=Math.floor(i/7);t="".concat(e," week ago")}else if(i<=365){let e=Math.floor(i/30);t="".concat(e," month ago")}else{let e=Math.floor(i/365);t="".concat(e," year ago")}let r=s.toLocaleDateString("en-US",{month:"short",day:"numeric"});return s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),"".concat(t,", ").concat(r)}let ej=async e=>{var t,s;q(!1),"assign-user"===e.key?_.A.show("Assign User",(0,a.jsx)(C,{onClose:e=>{e&&x({msg:e,id:j().uuid()},"comment"),_.A.hide()},thread:p})):"block-contact"===e.key?_.A.show("Block ".concat(null===(t=JSON.parse((null==p?void 0:p.data)||"{}"))||void 0===t?void 0:t.sender_name,"?"),(0,a.jsx)(J,{onClose:()=>{_.A.hide()},onConFirm:async()=>{await eg(!0),_.A.hide()}})):"Unblock-contact"===e.key?await eg(!1):"profile"===e.key?(S.push({pathname:"/messages",query:{profile:"true",thread_id:S.query.thread_id}},void 0,{shallow:!0}),m("Profile")):"clear-chat"===e.key&&_.A.show("Clear Chat with ".concat(null===(s=JSON.parse((null==p?void 0:p.data)||"{}"))||void 0===s?void 0:s.sender_name,"?"),(0,a.jsx)(B,{onClose:()=>{_.A.hide()},onConFirm:async()=>{await ev({action:"delete_messages"}),_.A.hide()}}))},eN=(0,n.useCallback)(e=>{if(!e)return"";let t=e.match(/@\[(.*?)\]\(id:.*?\)\s?(.*)/);return t?"@".concat(t[1]," ").concat(t[2]):e},[]),ew=e=>{let t={};e.forEach(e=>{let s=eb(Number(e.time));t[s]||(t[s]=[]),t[s].push(e)}),y(e=>{let s={...e},a=Object.keys(s);return Object.keys(t).forEach(e=>{a.includes(e)&&(t[e].toReversed().forEach(t=>{s[e].unshift(t)}),delete t[e])}),{...t,...s}})},ek=e=>{e.stopPropagation(),m("Threads"),S.replace({pathname:S.pathname,query:{}},void 0,{shallow:!0})};function e_(e){let t=Number(e),s=Math.floor(t/60);return"".concat(s.toString().padStart(2,"0"),":").concat((t%60).toString().padStart(2,"0"))}(0,n.useEffect)(()=>{let e=e=>{0===e.target.scrollTop&&!en.current&&Object.keys(f).length>0&&ee&&ea(e=>e+1)},t=document.querySelector(".message-container");if(t)return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[en,Object.keys(f).length]),(0,n.useEffect)(()=>{ee&&ep(es)},[es]),(0,n.useEffect)(()=>{"blocked"==p.mode?(eo([{name:"View Contact Details",key:"profile",icon:(0,a.jsx)(w.JXP,{})},{name:"Assign Users",key:"assign-user",icon:(0,a.jsx)(w.Yh2,{})},{name:"Unblock Contact",key:"Unblock-contact",icon:(0,a.jsx)(k.lXy,{})},{name:"Clear Chat",icon:(0,a.jsx)(P.c8Z,{}),key:"clear-chat"}]),V(!0)):(eo([{name:"View Contact Details",key:"profile",icon:(0,a.jsx)(w.JXP,{})},{name:"Assign Users",key:"assign-user",icon:(0,a.jsx)(w.Yh2,{})},{name:"Block Contact",key:"block-contact",icon:(0,a.jsx)(k.lXy,{})},{name:"Clear Chat",icon:(0,a.jsx)(P.c8Z,{}),key:"clear-chat"}]),V(!1)),ee&&ep(es)},[ed,es]),(0,n.useEffect)(()=>{y({}),ec.current=!1,et(!0),ea(()=>(ex(),ep(0),0))},[E]),(0,n.useEffect)(()=>{let e=v.A.getInstance(ed),t=e=>{"message_created"===e.type?E===e.thread_id&&x({msg:"",id:""},"text",e.data):"message_status_updated"===e.type&&E===e.thread_id&&y(t=>{let s={...t};for(let t of Object.keys(s)){let a=s[t].findIndex(t=>t.id===e.data.id);if(-1!==a){"read"!==s[t][a].status&&(s[t][a].status=e.data.status);break}}return s})};return e.on("message",t),()=>{e.off(t)}},[ed,E]);let eS=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,s=[],a=[];for(let n=0;n<e.length;n++){let i=e[n],r="image"===i.type,l=a.length>0?a[a.length-1]:null;if(r){let e=Number(i.time),n=l?Number(l.time):null;l&&Math.abs(e-n)/1e3<=60*t&&i.by===l.by?a.push(i):(a.length>0&&s.push([...a]),a=[i])}else a.length>0&&s.push([...a]),a=[],s.push(i)}return a.length>0&&s.push(a),s};return E?(0,a.jsxs)("div",{className:"text-black bg-white shadow-lg flex flex-col ".concat(i&&"Message"===s?"w-full":"w-1/2"),children:[Z&&(0,a.jsx)("div",{className:"w-[-webkit-fill-available] absolute text-white mx-[20px] z-[6]",children:(0,a.jsxs)("div",{className:"flex justify-around  px-[10px] py-[4px] bg-red-500 rounded max-w-[290px] m-auto",children:[(0,a.jsx)("div",{children:Z}),(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>K(""),children:"x"})]})}),(0,a.jsxs)("div",{className:"flex justify-between items-center pt-[7px] pb-[7px] pl-[18px] pr-[18px] border-b border-[#CAD4E0] h-[60px]",children:[(0,a.jsxs)("div",{className:"flex justify-center items-center",onClick:()=>{p.id&&(S.push({pathname:"/messages",query:{profile:"true",thread_id:S.query.thread_id}},void 0,{shallow:!0}),m("Profile"))},children:[i&&"Message"===s&&(0,a.jsx)("div",{onClick:e=>ek(e),className:"cursor-pointer",children:(0,a.jsx)(O.K9R,{size:"24px",className:"mr-2"})}),(0,a.jsxs)("div",{className:"relative w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center cursor-pointer",children:[(0,a.jsx)(r(),{src:l.ff,height:24,width:24,alt:"User-icon"}),(e=>!!e&&ei.map(e=>e.value).includes(e))(p.channel)&&(0,a.jsx)("span",{className:"absolute bottom-[0px] left-[0px] bg-white rounded-2xl",children:p.channel&&(0,a.jsx)(r(),{src:eu[null==p?void 0:p.channel],height:16,width:16,alt:"channel"})})]}),(0,a.jsxs)("div",{className:"text-[14px] ml-[10px]",children:[(0,a.jsx)("div",{children:null===(t=JSON.parse((null==p?void 0:p.data)||"{}"))||void 0===t?void 0:t.sender_name}),(0,a.jsx)("div",{children:p.from})]})]}),(0,a.jsx)("div",{className:"flex justify-center items-center gap-[23px]",children:(0,a.jsx)("div",{className:"cursor-pointer",children:(0,a.jsxs)("div",{className:" flex flex-col gap-3 justify-end items-end relative",children:[(0,a.jsx)(N.mqA,{className:"text-2xl textPrimary500 ".concat(p.id?"":"opacity-50 cursor-not-allowed"),onClick:()=>{p.id&&q(!U)}}),U&&(0,a.jsx)("nav",{ref:er,className:"flex w-max flex-col absolute top-[42px] z-50 rounded-sm p-2  border-[0.4px]  border-[#CAD4E0] bg-white shadow-[box-shadow: 0px 8px 10px -6px rgba(0, 0, 0, 0.10), 0px 20px 25px -5px rgba(0, 0, 0, 0.10)]",children:(0,a.jsx)(c,{tabs:el,handleBtnClick:ej,isActiveShow:!1})})]})})})]}),(0,a.jsxs)("div",{className:"w-auto flex-1 p-4 overflow-y-auto bg-white text-[14px] overflow-auto grow message-container",ref:b,children:[ee&&(0,a.jsxs)("div",{className:"text-center py-4",children:[0==Object.keys(f).length&&"Loading threads...",en.current&&0!==Object.keys(f).length&&"Loading more messages..."]}),Object.keys(f).map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex justify-center my-[10px]",style:{fontWeight:"bold",margin:"10px 0"},children:(0,a.jsx)("span",{className:"font-medium rounded bg-[#EDF1FE] py-[2px] px-[10px]",children:e})}),(0,a.jsx)("div",{className:"space-y-3",children:eS(f[e]).map((e,t)=>{if(!Array.isArray(e))return(0,a.jsx)("div",{className:"flex gap-[10px] w-full ".concat("user"===e.by?"flex-row":" flex-row-reverse"),children:(0,a.jsx)("div",{className:"flex w-11/12 ".concat("user"===e.by?"justify-start":"justify-end"),children:(()=>{var t,s,n,i,o,d,c,u,h,m,x,p,g,v,f,y,b,j,N,w,k,_,S,C,A,O,P,F,M,D,T,I,J,B,R,L,U,q,H;switch(e.type){case"comment":return(0,a.jsxs)("div",{className:"rounded-[4px] border-[0.3px] border-[#DA2777] p-[12px] bg-[#FBE6F2]",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:JSON.parse(e.data).by.name||JSON.parse(e.data).by.email})," ","left a task for you"," "]}),(0,a.jsxs)("div",{className:"font-medium",children:['"',eN(JSON.parse(e.data).message.content),'"']}),(0,a.jsx)("div",{className:"text-[#64748A]",children:eb(Number(e.time))})]});case"text":return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("div",{className:"flex my-1 ".concat("user"===e.by?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"inline-block break-words text-sm font-medium leading-snug max-w-xs relative\n                                        ".concat("user"===e.by?"bgMediumBlue text-white px-4 pt-2 pb-6 rounded-r-xl rounded-tl-xl":"bg-gray-200 text-black px-4 pt-2 pb-6 rounded-l-xl rounded-tr-xl","\n                                      "),children:[null===(n=JSON.parse(e.data||"{}"))||void 0===n?void 0:null===(s=n.message)||void 0===s?void 0:null===(t=s.content)||void 0===t?void 0:t.split("\n").map(e=>(0,a.jsx)("div",{children:e},e)),(0,a.jsxs)("span",{className:"absolute bottom-1 right-2 flex items-center gap-1",children:["read"===e.status&&(0,a.jsx)(r(),{src:l.Er,height:14,alt:"read"}),"delivered"===e.status&&(0,a.jsx)(r(),{src:l.Yv,height:14,alt:"delivered"}),"failed"===e.status&&(0,a.jsx)(r(),{src:l.f,height:14,alt:"failed"})]})]})}),(0,a.jsx)("div",{className:"flex mt-1 items-center text-xs font-medium leading-tight text-neutral-400\n                                      ".concat("user"===e.by?"justify-start":"justify-end","\n                                    "),children:ey(Number(e.time))})]})});case"video":return(0,a.jsx)(z,{orgId:ed,mediaId:"".concat(null===(d=JSON.parse(e.data))||void 0===d?void 0:null===(o=d.message)||void 0===o?void 0:null===(i=o.content)||void 0===i?void 0:i.id),thread_id:E,content_type:"".concat(null===(h=JSON.parse(e.data))||void 0===h?void 0:null===(u=h.message)||void 0===u?void 0:null===(c=u.content)||void 0===c?void 0:c.mime_type),filename:null===(p=JSON.parse(e.data))||void 0===p?void 0:null===(x=p.message)||void 0===x?void 0:null===(m=x.content)||void 0===m?void 0:m.filename,filesize:(null===(f=JSON.parse(e.data))||void 0===f?void 0:null===(v=f.message)||void 0===v?void 0:null===(g=v.content)||void 0===g?void 0:g.size)?(Number(null===(j=JSON.parse(e.data))||void 0===j?void 0:null===(b=j.message)||void 0===b?void 0:null===(y=b.content)||void 0===y?void 0:y.size)/1048576).toFixed(1)+" MB":"",duration:(null===(k=JSON.parse(e.data))||void 0===k?void 0:null===(w=k.message)||void 0===w?void 0:null===(N=w.content)||void 0===N?void 0:N.duration)?e_(null===(C=JSON.parse(e.data))||void 0===C?void 0:null===(S=C.message)||void 0===S?void 0:null===(_=S.content)||void 0===_?void 0:_.duration):"",time:ey(Number(e.time)),by:e.by,status:e.status});case"document":return(0,a.jsx)(z,{orgId:ed,mediaId:"".concat(null===(P=JSON.parse(e.data))||void 0===P?void 0:null===(O=P.message)||void 0===O?void 0:null===(A=O.content)||void 0===A?void 0:A.id),thread_id:E,content_type:"".concat(null===(D=JSON.parse(e.data))||void 0===D?void 0:null===(M=D.message)||void 0===M?void 0:null===(F=M.content)||void 0===F?void 0:F.mime_type),filename:null===(J=JSON.parse(e.data))||void 0===J?void 0:null===(I=J.message)||void 0===I?void 0:null===(T=I.content)||void 0===T?void 0:T.filename,filesize:(null===(L=JSON.parse(e.data))||void 0===L?void 0:null===(R=L.message)||void 0===R?void 0:null===(B=R.content)||void 0===B?void 0:B.size)?(Number(null===(H=JSON.parse(e.data))||void 0===H?void 0:null===(q=H.message)||void 0===q?void 0:null===(U=q.content)||void 0===U?void 0:U.size)/1048576).toFixed(1)+" MB":"",time:ey(Number(e.time)),by:e.by,status:e.status});default:return(0,a.jsx)("div",{})}})()})},e.id);{let s="user"===e[0].by;return e.length>4?(0,a.jsx)("div",{className:"flex ".concat(s?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"flex flex-col items-end",children:[(0,a.jsx)("div",{className:"grid grid-cols-2 gap-1 ".concat(s?"bgMediumBlue":"bg-neutral-200"," p-1 rounded-xl shadow max-w-xs overflow-hidden"),children:e.slice(0,4).map((t,s)=>{var n,i,l;return(0,a.jsxs)("div",{className:"relative w-full h-full aspect-square rounded-xl overflow-hidden cursor-pointer",onClick:()=>{em(e)},children:[(0,a.jsx)(r(),{width:200,height:200,src:"".concat(I.A.apiUrl,"/orgs/").concat(ed,"/whatsapp/media/").concat(null===(l=JSON.parse(t.data))||void 0===l?void 0:null===(i=l.message)||void 0===i?void 0:null===(n=i.content)||void 0===n?void 0:n.id,"?access_token=").concat(d.A.token(),"&thread_id=").concat(E),alt:"WhatsApp Media",className:"w-full h-full object-cover rounded-xl"}),3===s&&e.length>4&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,a.jsxs)("span",{className:"text-white text-2xl font-bold",children:["+",e.length-4]})})]},t.id)})}),(0,a.jsxs)("div",{className:"flex mt-1 items-center text-xs font-medium leading-tight text-neutral-400 ".concat(s?"justify-end":"justify-start"),children:[ey(Number(e[e.length-1].time)),"read"===e[e.length-1].status&&(0,a.jsx)(r(),{src:l.Er,height:14,alt:"read"}),"delivered"===e[e.length-1].status&&(0,a.jsx)(r(),{src:l.Yv,height:14,alt:"delivered"}),"failed"===e[e.length-1].status&&(0,a.jsx)(r(),{src:l.f,height:14,alt:"failed"})]})]})},"group-".concat(t)):e.map((e,t)=>{var s,n,i,r,l,o,d,c,u,h,m,x,p,g,v,f,y,b,j,N,w;return(0,a.jsx)("div",{className:"flex gap-[10px] w-full ".concat("user"===e.by?"flex-row":" flex-row-reverse"),children:(0,a.jsx)("div",{className:"flex w-11/12 ".concat("user"===e.by?"justify-start":"justify-end"),children:(0,a.jsx)(z,{orgId:ed,mediaId:"".concat(null===(i=JSON.parse(e.data))||void 0===i?void 0:null===(n=i.message)||void 0===n?void 0:null===(s=n.content)||void 0===s?void 0:s.id),thread_id:E,content_type:"".concat(null===(o=JSON.parse(e.data))||void 0===o?void 0:null===(l=o.message)||void 0===l?void 0:null===(r=l.content)||void 0===r?void 0:r.mime_type),filename:null===(u=JSON.parse(e.data))||void 0===u?void 0:null===(c=u.message)||void 0===c?void 0:null===(d=c.content)||void 0===d?void 0:d.filename,filesize:(null===(x=JSON.parse(e.data))||void 0===x?void 0:null===(m=x.message)||void 0===m?void 0:null===(h=m.content)||void 0===h?void 0:h.size)?(Number(null===(v=JSON.parse(e.data))||void 0===v?void 0:null===(g=v.message)||void 0===g?void 0:null===(p=g.content)||void 0===p?void 0:p.size)/1048576).toFixed(1)+" MB":"",duration:(null===(b=JSON.parse(e.data))||void 0===b?void 0:null===(y=b.message)||void 0===y?void 0:null===(f=y.content)||void 0===f?void 0:f.duration)?e_(null===(w=JSON.parse(e.data))||void 0===w?void 0:null===(N=w.message)||void 0===N?void 0:null===(j=N.content)||void 0===j?void 0:j.duration):"",time:ey(Number(e.time)),by:e.by,status:e.status})})},e.id)})}})})]},e)),0==Object.keys(f).length&&!en.current&&(0,a.jsx)("div",{className:"flex justify-center my-[10px]",children:"No messages available."}),p.to&&0!==Object.keys(f).length&&(0,a.jsx)("div",{className:"flex justify-center my-[10px]",children:(0,a.jsxs)("span",{className:"italic rounded py-[2px] px-[10px]",children:["Sending Reply With: ",p.to]})})]}),(0,a.jsx)(L,{thread:p,isAiEnabled:$,setIsAiEnabled:Q,contactBlocked:G,updateBlockStatus:eg,message:D,isMessageDropDownOPen:F,setIsMessageDropDownOPen:M,setMessage:R,sendMessageHandler:ef,handleTemplateForMessage:()=>{M(!1),_.A.show("Select Template",(0,a.jsx)(T,{onClose:async e=>{e.msg&&(Q(!1),x(e,"text")),_.A.hide()},thread:p}))},isMobileView:i,setIsAi:e=>{ec.current&&ev({action:"set_mode",mode:e?"auto":"manual"})}}),eh&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"relative bg-white p-4 rounded-lg max-w-3xl max-h-full overflow-auto",children:[(0,a.jsx)(H.$,{className:"absolute top-2 right-2 text-gray-600 text-2xl font-bold",onClick:()=>em(null),children:(0,a.jsx)(Y.iCo,{})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-10",children:eh.map(e=>{var t,s,n,i,r,l;return(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(z,{orgId:ed,mediaId:"".concat(null===(n=JSON.parse(e.data))||void 0===n?void 0:null===(s=n.message)||void 0===s?void 0:null===(t=s.content)||void 0===t?void 0:t.id),thread_id:E,content_type:"".concat(null===(l=JSON.parse(e.data))||void 0===l?void 0:null===(r=l.message)||void 0===r?void 0:null===(i=r.content)||void 0===i?void 0:i.mime_type)})},e.id)})})]})})]}):(0,a.jsxs)("div",{className:"w-100% m-auto",children:[" ",(0,a.jsx)(X,{})]})};var V=s(34648),Z=s(46104);let K=e=>{var t;let{activePage:s,isMobileView:i,setActivePage:c}=e,u=(0,h.useRouter)(),{thread_id:m,profile:x}=u.query,p=o.A.currentId(),[g,v]=(0,n.useState)(null),f=(0,n.useRef)(null),y=(0,n.useCallback)(async()=>{if(m)try{let{data:e,error:t}=await d.A.doGet({path:"orgs/".concat(p,"/data/threads/").concat(m)});if(t){console.error("Error fetching invited users:",t);return}e&&e.thread&&(v(e.thread),f.current=function(e){let t=new Date;return t.setHours(0,0,0,0),e.filter(e=>{let s=new Date(e.time);return s.setHours(0,0,0,0),s.getTime()===t.getTime()}).length}(e.messages))}catch(e){console.error("Error fetching thread:",e)}},[p,m]);return(0,n.useEffect)(()=>{x&&"true"===x&&y()},[m,x,y]),(0,a.jsxs)("div",{className:"flex flex-col w-1/2 bg-white shadow-lg p-6 ".concat(i&&"Profile"===s?"w-full":"w-1/2"),children:[(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:()=>{let{thread_id:e}=u.query;u.push({pathname:"/messages",query:{thread_id:e}}),c("Message")},className:"cursor-pointer",children:(0,a.jsx)(Z.A,{className:"text-gray-400"})})}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 items-center justify-center mb-4",children:[(0,a.jsx)("div",{className:"rounded-full w-24 h-24 object-cover border-2 border-gray-200 flex items-center justify-center",children:(0,a.jsx)(r(),{src:l.ff,alt:"user",width:60,height:60,className:"rounded-full w-full h-full object-cover"})}),(0,a.jsx)("h1",{className:"font-bold",children:"string"==typeof(null==g?void 0:g.data)&&JSON.parse(null==g?void 0:g.data).sender_name})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("h2",{className:"textSecondary600 text-sm font-bold",children:"Recent Activity"}),(0,a.jsxs)("div",{className:"mt-3 flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(r(),{src:l.BQ,width:16,height:16,alt:"chatIcon",className:"invert-50"}),(0,a.jsxs)("span",{className:"text-[#737373] text-xs font-medium",children:[null==f?void 0:f.current," messages today"]})]}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(r(),{src:l.Qm,width:16,height:16,alt:"chatIcon",className:"invert-50"}),(0,a.jsxs)("span",{className:"text-[#737373] text-xs font-medium",children:["Last message \xa0: \xa0",(0,V.g)(Number(null==g?void 0:g.last_active_at))]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col mt-8",children:[(0,a.jsx)("h2",{className:"text-[#475569] text-sm font-bold",children:"Summary"}),(0,a.jsx)("p",{className:"textSecondary700 text-sm font-medium mt-4",children:"string"==typeof(null==g?void 0:g.data)&&(null===(t=JSON.parse(null==g?void 0:g.data).about)||void 0===t?void 0:t.summary)||"Not available"})]})]})},$=()=>{let{query:e}=(0,h.useRouter)(),{profile:t}=e,[s,i]=(0,n.useState)("Threads"),[r,l]=(0,n.useState)(!1),[d,c]=(0,n.useState)({}),u=o.A.currentId(),[m,x]=(0,n.useState)({}),p=(0,n.useRef)(null),g=(0,n.useCallback)(function(e,t){let s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0!==Object.keys(a).length)s=a;else{var n,i;s={id:e.id,org_id:u,thread_id:m.id,type:t,status:"sent",time:new Date().getTime().toString(),data:JSON.stringify({message:{content:e.msg},by:{name:null===(n=JSON.parse((null==m?void 0:m.data)||"{}"))||void 0===n?void 0:n.sender_name,email:null===(i=JSON.parse((null==m?void 0:m.data)||"{}"))||void 0===i?void 0:i.sender_email}}),tag:"",by:"text"==t?"bot_agent":"human_agent",agent_id:null}}c(e=>{let t=Object.keys(e).find(e=>e.includes("Today")),a={...e};if(t){var n;if(null===(n=e[t].find(e=>e.id===s.id))||void 0===n?void 0:n.id)return a}if(t)a[t]?a[t].push(s):a[t]=[s];else{let e=function(e){let t;let s=new Date(e),a=new Date,n=new Date(s.getFullYear(),s.getMonth(),s.getDate()),i=Math.floor((new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()-n.getTime())/864e5);if(0===i)t="Today";else if(1===i)t="Yesterday";else if(i<=6)t="".concat(i," days ago");else if(i<=29){let e=Math.floor(i/7);t="".concat(e," week ago")}else if(i<=365){let e=Math.floor(i/30);t="".concat(e," month ago")}else{let e=Math.floor(i/365);t="".concat(e," year ago")}let r=s.toLocaleDateString("en-US",{month:"short",day:"numeric"});return s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),"".concat(t,", ").concat(r)}(Number(s.time));a[e]?a[e].push(s):a[e]=[s]}return a}),setTimeout(()=>{p&&p.current&&(p.current.scrollTop=p.current.scrollHeight)},10)},[u,m.id,m.data]);return(0,n.useEffect)(()=>{let e=window.matchMedia("(max-width: 767px)"),t=e=>{l(e.matches)};return t(e),e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}},[]),(0,a.jsxs)("div",{className:"flex gap-[2px] flex-row",style:{height:"-webkit-fill-available"},children:[(!r||"Threads"===s)&&(0,a.jsx)(y,{activePage:s,isMobileView:r,setActivePage:i,messages:d,setMessages:c}),(!r||"Message"===s)&&(0,a.jsx)(G,{activePage:s,isMobileView:r,setActivePage:i,addMessageToList:g,thread:m,setThread:x,messages:d,setMessages:c,messagesContainerRef:p}),(!r||"Profile"===s)&&t&&"true"===t&&(0,a.jsx)(K,{activePage:s,isMobileView:r,setActivePage:i})]})}},60124:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/messages",function(){return s(58951)}])},94344:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var a=s(14232);let n=(e,t)=>{(0,a.useEffect)(()=>{let s=s=>{!e.some(e=>e.current&&e.current.contains(s.target))&&t(s)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[e,t])}}},e=>{var t=t=>e(e.s=t);e.O(0,[5711,4938,2517,7141,2236,9035,636,6593,8792],()=>t(60124)),_N_E=e.O()}]);