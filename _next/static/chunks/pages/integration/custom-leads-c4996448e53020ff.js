(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2102],{1444:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var s=a(37876),r=a(74562),l=a(65259),n=a(43598),d=a(96154),o=a(45982),i=a(89099),c=a(14232),m=a(75683);let u=()=>{let[e,t]=(0,c.useState)([]),[a,r]=(0,c.useState)(""),[o,u]=(0,c.useState)(!1),[p,b]=(0,c.useState)(!1),g=(0,i.useRouter)(),y=(0,c.useCallback)(async()=>{try{u(!0);let e=await l.A.doGet({path:"/orgs/".concat(n.A.currentId(),"/leads/connections")});if(e.error&&"item_not_found"===e.error.code){let{data:e,error:t}=await l.A.doPost({path:"/orgs/".concat(n.A.currentId(),"/leads/connections?setup=true"),data:{}});if(t){console.log("Error creating connection:",t),u(!1);return}e&&y()}t(e.data.connection.responses),r(e.data.connection.api_key),u(!1)}catch(e){console.log(e),t([]),u(!1)}},[]);return(0,c.useEffect)(()=>{y()},[y,p]),(0,s.jsx)("div",{className:"p-4",children:(0,s.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg p-6 text-gray-700",children:[(0,s.jsx)("button",{className:"text-4xl hover:text-gray-800 mb-4 cursor-pointer",onClick:()=>g.push("/settings/?tab=channels-management"),children:(0,s.jsx)(m.eh5,{})}),(0,s.jsxs)("div",{className:"flex flex-col items-start mb-8",children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:"Custom Leads"}),(0,s.jsxs)("div",{className:"text-sm mt-2",children:[(0,s.jsx)("span",{className:"font-bold",children:"API Key:"})," ",a]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("div",{className:"text-lg font-bold",children:"Auto Respond Leads on WhatsApp"}),(0,s.jsx)(h,{setRefetchNumbers:b,connections:e})]}),o&&(0,s.jsx)("div",{className:"flex justify-center items-center h-20",children:(0,s.jsx)(d.A,{className:"animate-spin text-gray-600",size:32})}),!o&&0===e.length&&(0,s.jsx)("div",{className:"flex justify-center items-center h-20 text-gray-700 font-bold text-2xl",children:"Connections not added yet"}),!o&&e.length>0&&(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"overflow-y-auto max-h-90 rounded-lg",children:[(0,s.jsxs)("div",{className:"grid grid-cols-3 bg-gray-100 text-gray-700 font-medium py-3 px-5 sticky top-0",children:[(0,s.jsx)("div",{children:"Form Id"}),(0,s.jsx)("div",{children:"Template"}),(0,s.jsx)("div",{children:"Action"})]}),e.map((t,a)=>(0,s.jsx)(x,{template:t,setRefetchNumbers:b,connections:e},a))]})})]})})};function h(e){let{setRefetchNumbers:t,connections:a}=e,[r,d]=(0,c.useState)(!1),[o,i]=(0,c.useState)([]),[m,u]=(0,c.useState)(""),[h,x]=(0,c.useState)(null),[p,b]=(0,c.useState)(!1),[g,y]=(0,c.useState)(""),f=(0,c.useRef)(null),v=e=>{let t=[];for(let s of e){let e=!1;for(let t of s.components){var a;if("header"===t.type.toLowerCase()&&t.example){e=!1;break}"body"===t.type.toLowerCase()&&(null===(a=t.example)||void 0===a?void 0:a.body_text_named_params)&&1==t.example.body_text_named_params.length&&"name"===t.example.body_text_named_params[0].param_name&&(e=!0)}e&&t.push(s)}return t},j=(0,c.useCallback)(async()=>{let e=await l.A.doGet({path:"/orgs/".concat(n.A.currentId(),"/whatsapp/templates")});if(e.error)console.error("Failed to fetch whatsapp templates",e.error);else{var t;let a=v((null===(t=e.data)||void 0===t?void 0:t.templates)||[]);console.log(a),i(a)}},[]),w=async()=>{if(!m||!m.trim()){y("Form ID not provided");return}if(!h||!h.waba||!h.name){y("Template not selected");return}if(a.find(e=>e.form_id===m)){y("Form ID already exists");return}b(!0),y("");let e={form_id:m,whatsapp:{template_name:(null==h?void 0:h.name)||"",waba:(null==h?void 0:h.waba)||""}},s=await l.A.doPost({path:"/orgs/".concat(n.A.currentId(),"/leads/connections"),data:{responses:[...a,e]}});if(b(!1),s.error){y(s.error.message);return}s.data&&t(e=>!e),d(!1),u(""),x(null),y("")};return(0,c.useEffect)(()=>{var e,t;r?null===(e=f.current)||void 0===e||e.showModal():null===(t=f.current)||void 0===t||t.close(),y("")},[r]),(0,c.useEffect)(()=>{j()},[j]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>d(!0),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Add New"}),(0,s.jsxs)("dialog",{ref:f,className:"bg-white p-6 rounded-lg shadow-lg text-gray-700 fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",onClick:e=>{e.target===f.current&&d(!1)},children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Enter details"}),(0,s.jsx)("input",{type:"text",className:"border border-gray-300 rounded-md p-2 w-full mb-4",placeholder:"Enter form id",value:m,onChange:e=>u(e.target.value)}),(0,s.jsxs)("select",{className:"border border-gray-300 rounded-md p-2 w-full mb-4",value:(null==h?void 0:h.waba)||"",onChange:e=>x(o.find(t=>t.waba===e.target.value)||null),children:[(0,s.jsx)("option",{value:"",children:"Select Template"}),o.map(e=>(0,s.jsx)("option",{value:e.waba,children:e.name},e.id))]}),g&&(0,s.jsx)("p",{className:"text-sm text-red-600 mt-2 text-right",children:g}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,s.jsx)("button",{onClick:()=>d(!1),className:"px-4 py-2 bg-gray-300 rounded-md hover:bg-gray-400",children:"Cancel"}),(0,s.jsx)("button",{onClick:w,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:bg-gray-400",disabled:p,children:"Add"})]})]})]})}let x=e=>{let{template:t,setRefetchNumbers:a,connections:i}=e,[m,u]=(0,c.useState)(!1),[h,x]=(0,c.useState)(null),p=async()=>{let e=i.filter(e=>e.form_id!==t.form_id);u(!0),x(null);let s=await l.A.doPost({path:"/orgs/".concat(n.A.currentId(),"/leads/connections"),data:{responses:e}});if(s.error){x(s.error.message),u(!1);return}s.data&&(a(e=>!e),u(!1),r.A.hide())};return(0,c.useEffect)(()=>{h&&setTimeout(()=>{x(null)},3e3)},[h]),(0,s.jsxs)("div",{className:"grid grid-cols-3 items-center py-4 px-5 border-b border-gray-100 hover:bg-gray-50",children:[(0,s.jsx)("div",{className:"max-w-[160px] overflow-hidden text-ellipsis whitespace-nowrap",title:t.form_id||"N/A",children:(0,s.jsx)("span",{className:"inline-block",children:t.form_id})}),(0,s.jsx)("div",{className:"max-w-[160px] overflow-hidden text-ellipsis whitespace-nowrap",title:t.whatsapp.template_name||"N/A",children:(0,s.jsx)("span",{className:"inline-block",children:t.whatsapp.template_name})}),(0,s.jsx)("div",{children:(0,s.jsx)("button",{className:"text-red-600 hover:text-red-800",onClick:()=>r.A.show("Confirm Delete",(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-700 mb-4",children:"Are you sure you want to delete this connection?"}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)("button",{className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-md mr-2 hover:bg-gray-400",onClick:()=>r.A.hide(),children:"Cancel"}),(0,s.jsx)("button",{className:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 disabled:bg-gray-400 ",onClick:p,disabled:m,children:m?(0,s.jsx)(d.A,{className:"animate-spin text-white",size:16}):"Delete"})]})]})),children:(0,s.jsx)(o.A,{size:20,className:"cursor-pointer"})})})]})}},33779:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/integration/custom-leads",function(){return a(1444)}])},45982:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(95551).A)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},96154:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(95551).A)("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[5711,636,6593,8792],()=>t(33779)),_N_E=e.O()}]);