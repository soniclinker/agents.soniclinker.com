(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6537],{42347:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var s=a(37876),r=a(74562),l=a(3176),n=a(65259),d=a(43598),o=a(96154),i=a(45982),c=a(14e3),m=a(14232),h=a(75683);let u=e=>{let{appId:t,redirectUri:a}=e;return(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("button",{onClick:()=>{let e="https://www.facebook.com/v18.0/dialog/oauth?"+"client_id=".concat(t)+"&redirect_uri=".concat(encodeURIComponent(a))+"&scope=pages_show_list,pages_read_engagement,pages_manage_metadata,leads_retrieval,business_management,pages_manage_ads&response_type=code";window.location.href=e},className:"bgMediumBlue hover:bgHardBlue text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-300",children:"Connect with Facebook"})})},x=function(){let e=(0,c.useRouter)(),[t,a]=(0,m.useState)([]),[i,x]=(0,m.useState)([]),[g,f]=(0,m.useState)([]),[v,y]=(0,m.useState)(!1),[w,j]=(0,m.useState)(!1),N=async e=>{let t=g.filter(t=>t.form_id!==e.form_id),a=await n.A.doPost({path:"/orgs/".concat(d.A.currentId(),"/fb/connections"),data:{responses:t}});if(a.error){console.error("Failed to delete response",a.error);return}a.data&&j(e=>!e),r.A.hide()},k=(0,m.useCallback)(async()=>{y(!0);let e=await n.A.doGet({path:"/orgs/".concat(d.A.currentId(),"/fb/connections")});if(e.error)console.error("Failed to fetch Facebook pages",e.error);else{var t,s;a((null===(t=e.data)||void 0===t?void 0:t.pages)||[]),f((null===(s=e.data)||void 0===s?void 0:s.responses)||[])}y(!1)},[]),_=(0,m.useCallback)(async()=>{let e=await n.A.doGet({path:"/orgs/".concat(d.A.currentId(),"/fb/leadforms")});e.error?console.error("Failed to fetch lead froms",e.error):(x(e.data.forms),console.log(e.data.forms))},[]),A=async()=>{let e=await n.A.doDelete({path:"/orgs/".concat(d.A.currentId(),"/fb/connections")});e.error?console.error("Failed to disconnect Facebook",e.error):a([])};return(0,m.useEffect)(()=>{k(),_()},[w,k,_]),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"p-4",children:(0,s.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg p-6 text-gray-700",children:[(0,s.jsx)("button",{className:"text-4xl hover:text-gray-800 mb-4 cursor-pointer",onClick:()=>e.back(),children:(0,s.jsx)(h.eh5,{})}),(0,s.jsxs)("div",{className:"flex flex-wrap justify-between items-center mb-8",children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:"Facebook Lead Center"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-4 mt-4",children:[(0,s.jsx)(u,{appId:l.A.facebookAppId,redirectUri:"".concat(l.A.appUrl,"/integration/facebook/callback")}),t&&t.length>0&&(0,s.jsx)("button",{onClick:A,className:"bgMediumBlue hover:bgHardBlue text-white font-semibold px-6 py-2 rounded-lg shadow-md transition duration-300",children:"Disconnect"})]})]}),t.length>0&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"mt-8 mb-8",children:[(0,s.jsx)("div",{className:"text-xl font-semibold text-gray-700",children:"Connected Pages"}),(0,s.jsx)("div",{className:"mt-2 flex flex-wrap gap-4",children:t.map(e=>(0,s.jsx)("div",{className:"w-fit min-w-40 flex items-center justify-between bg-white shadow p-4 border border-slate-200 rounded-lg mt-2",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("div",{className:"text-lg font-semibold",children:e.name}),(0,s.jsx)("div",{className:"text-gray-500 text-sm",children:e.category})]})},e.id))})]})}),t.length>0&&(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-xl font-semibold text-gray-700",children:"Auto Respond Leads on WhatsApp"}),(0,s.jsx)(b,{setRefetchNumbers:j,responses:g,forms:i})]}),t.length>0&&v&&(0,s.jsx)("div",{className:"flex justify-center items-center h-20",children:(0,s.jsx)(o.A,{className:"animate-spin text-gray-600",size:32})}),!v&&t.length>0&&0===g.length&&(0,s.jsx)("div",{className:"flex justify-start items-center h-20 text-gray-700 font-bold text-2xl",children:"Auto responce not set yet"}),!v&&t.length>0&&g.length>0&&(0,s.jsxs)("div",{className:"overflow-y-auto max-h-90 rounded-lg mt-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-3 bg-gray-100 text-gray-700 font-medium py-3 px-5 sticky top-0",children:[(0,s.jsx)("div",{children:"Form Id"}),(0,s.jsx)("div",{children:"Template"}),(0,s.jsx)("div",{children:"Action"})]}),g.map((e,t)=>(0,s.jsx)(p,{response:e,handleDelete:N,forms:i,setRefetchNumbers:j},t))]})]})})})},p=e=>{var t,a,l;let{response:n,handleDelete:d,forms:o}=e;return(0,s.jsxs)("div",{className:"grid grid-cols-3 items-center py-4 px-5 border-b border-gray-100 hover:bg-gray-50",children:[(0,s.jsx)("div",{className:"max-w-[260px] overflow-hidden text-ellipsis whitespace-nowrap",title:(null==n?void 0:n.form_id)||"N/A",children:(0,s.jsx)("span",{className:"inline-block text-wrap",children:(null===(t=o.find(e=>e.id===n.form_id))||void 0===t?void 0:t.name)||"N/A"})}),(0,s.jsx)("div",{className:"max-w-[160px] overflow-hidden text-ellipsis whitespace-nowrap mx-4",title:(null===(a=n.whatsapp)||void 0===a?void 0:a.template_name)||"N/A",children:(0,s.jsx)("span",{className:"inline-block text-wrap break-words",children:(null===(l=n.whatsapp)||void 0===l?void 0:l.template_name)||"N/A"})}),(0,s.jsx)("div",{children:(0,s.jsx)("button",{className:"text-red-600 hover:text-red-800",onClick:()=>r.A.show("Confirm Delete",(0,s.jsx)(g,{onDelete:d,response:n})),children:(0,s.jsx)(i.A,{size:20,className:"cursor-pointer"})})})]})},g=e=>{let{onDelete:t,response:a}=e,[l,n]=(0,m.useState)(!1),d=async e=>{n(!0),await t(e),n(!1)};return(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-700 mb-4",children:"Are you sure you want to delete this lead form?"}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)("button",{className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-md mr-2 hover:bg-gray-400",onClick:()=>r.A.hide(),children:"Cancel"}),(0,s.jsx)("button",{className:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 disabled:bg-gray-400 ",onClick:()=>d(a),disabled:l,children:"Delete"})]})]})};function b(e){let{setRefetchNumbers:t,responses:a,forms:r}=e,[l,o]=(0,m.useState)(!1),[i,c]=(0,m.useState)([]),[h,u]=(0,m.useState)(null),[x,p]=(0,m.useState)(null),[g,b]=(0,m.useState)(!1),[f,v]=(0,m.useState)(""),y=(0,m.useRef)(null),w=e=>{let t=[];for(let s of e){let e=!1;for(let t of s.components){var a;if("header"===t.type.toLowerCase()&&t.example){e=!1;break}"body"===t.type.toLowerCase()&&(null===(a=t.example)||void 0===a?void 0:a.body_text_named_params)&&1==t.example.body_text_named_params.length&&"name"===t.example.body_text_named_params[0].param_name&&(e=!0)}e&&t.push(s)}return t},j=(0,m.useCallback)(async()=>{let e=await n.A.doGet({path:"/orgs/".concat(d.A.currentId(),"/whatsapp/templates")});if(e.error)console.error("Failed to fetch whatsapp templates",e.error);else{var t;let a=w((null===(t=e.data)||void 0===t?void 0:t.templates)||[]);console.log(a),c(a)}},[]),N=async()=>{if(!h||!h.id){v("Form not selected");return}if(!x||!x.waba||!x.name){v("Template not selected");return}if(a.some(e=>e.form_id===h.id)&&a.some(e=>{var t;return(null===(t=e.whatsapp)||void 0===t?void 0:t.template_name)===x.name})){v("Form already exists");return}b(!0),v("");let e={responses:[...a,{form_id:h.id,whatsapp:{template_name:(null==x?void 0:x.name)||"",waba:(null==x?void 0:x.waba)||""}}]},s=await n.A.doPost({path:"/orgs/".concat(d.A.currentId(),"/fb/connections"),data:e});if(s.error){b(!1),v(s.error.message);return}s.data&&(t(e=>!e),console.log(s.data)),o(!1),b(!1),u(null),p(null),v("")};return(0,m.useEffect)(()=>{var e,t;l?null===(e=y.current)||void 0===e||e.showModal():null===(t=y.current)||void 0===t||t.close(),v("")},[l]),(0,m.useEffect)(()=>{j()},[j]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>o(!0),className:"px-4 py-2 bgMediumBlue text-white rounded-md hover:bgHardBlue",children:"Add New"}),(0,s.jsxs)("dialog",{ref:y,className:"bg-white p-6 rounded-lg shadow-lg text-gray-700 fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",onClick:e=>{e.target===y.current&&o(!1)},children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Enter details"}),(0,s.jsxs)("select",{className:"border border-gray-300 rounded-md p-2 w-full mb-4",value:(null==h?void 0:h.id)||"",onChange:e=>{u(r.find(t=>t.id===e.target.value)||null)},children:[(0,s.jsx)("option",{value:"",children:"Select Lead Form"}),r.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,s.jsxs)("select",{className:"border border-gray-300 rounded-md p-2 w-full mb-4",value:(null==x?void 0:x.waba)||"",onChange:e=>p(i.find(t=>t.waba===e.target.value)||null),children:[(0,s.jsx)("option",{value:"",children:"Select Template"}),i.map(e=>(0,s.jsx)("option",{value:e.waba,children:e.name},e.id))]}),f&&(0,s.jsx)("p",{className:"text-sm text-red-600 mt-2 text-right",children:f}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,s.jsx)("button",{onClick:()=>o(!1),className:"px-4 py-2 bg-gray-300 rounded-md hover:bg-gray-400",children:"Cancel"}),(0,s.jsx)("button",{onClick:N,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:bg-gray-400",disabled:g,children:"Add"})]})]})]})}},45982:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(95551).A)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},61649:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/integration/facebook",function(){return a(42347)}])},96154:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(95551).A)("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[5711,4e3,636,6593,8792],()=>t(61649)),_N_E=e.O()}]);